<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Emoji Dungeon: Vibe Check</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Mobile Optimization Resets */
        html, body {
            height: 100%;
            overflow: hidden;
            touch-action: manipulation; /* Disables double-tap zoom */
            overscroll-behavior: none; /* Prevents pull-to-refresh on some browsers */
            background-color: #020617; /* Slate 950 */
            -webkit-tap-highlight-color: transparent;
        }
        #root {
            height: 100%;
            width: 100%;
        }
        
        /* Custom Animations */
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }
        .animate-pulse-red {
            animation: pulse-red 2s infinite;
        }
        
        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="text-slate-200 font-sans antialiased selection:bg-purple-500 selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- CONSTANTS ---
        const STATS = {
            GRIT: { icon: 'üí™', color: 'text-orange-400', label: 'Grit' },
            VIBE: { icon: '‚ú®', color: 'text-purple-400', label: 'Vibe' },
            SPICE: { icon: 'üå∂Ô∏è', color: 'text-red-500', label: 'Spice' },
            LUCK: { icon: 'üçÄ', color: 'text-green-400', label: 'Luck' },
        };

        const ITEM_TYPES = {
            WEAPON: 'weapon',
            OFFHAND: 'offhand',
            HEAD: 'head',
            ACC: 'accessory',
        };

        const ITEMS = [
            { id: 'sword1', name: 'Rusty Pin', emoji: 'üìç', type: ITEM_TYPES.WEAPON, stats: { GRIT: 2 }, tags: ['metal'] },
            { id: 'sword2', name: 'Baguette', emoji: 'ü•ñ', type: ITEM_TYPES.WEAPON, stats: { GRIT: 3, VIBE: 1 }, tags: ['food'] },
            { id: 'shield1', name: 'Trash Lid', emoji: 'üóëÔ∏è', type: ITEM_TYPES.OFFHAND, stats: { GRIT: 1, LUCK: 2 }, tags: ['metal', 'urban'] },
            { id: 'hat1', name: 'Cool Shades', emoji: 'üï∂Ô∏è', type: ITEM_TYPES.HEAD, stats: { VIBE: 5 }, tags: ['cool'] },
            { id: 'acc1', name: 'Lucky Die', emoji: 'üé≤', type: ITEM_TYPES.ACC, stats: { LUCK: 5, SPICE: 2 }, tags: ['game'] },
            { id: 'food1', name: 'Spicy Taco', emoji: 'üåÆ', type: ITEM_TYPES.ACC, stats: { SPICE: 4, GRIT: 1 }, tags: ['food', 'spicy'] },
            { id: 'tech1', name: 'Old Phone', emoji: 'üì±', type: ITEM_TYPES.OFFHAND, stats: { VIBE: 3, LUCK: -1 }, tags: ['tech'] },
            { id: 'rare1', name: 'Ghost Chili', emoji: 'üëª', type: ITEM_TYPES.WEAPON, stats: { SPICE: 8, VIBE: 3 }, tags: ['spicy', 'spooky'] },
        ];

        const ENEMIES = [
            { name: 'Angry Blob', emoji: 'üíß', hp: 20, dmg: 3 },
            { name: 'Rat King', emoji: 'üêÄ', hp: 35, dmg: 5 },
            { name: 'Wifi Demon', emoji: 'üì∂', hp: 50, dmg: 8 },
            { name: 'Bureaucrat', emoji: 'üëî', hp: 80, dmg: 12 },
        ];

        // --- COMPONENTS ---

        // Compact Item Card for Inventory List
        const InventoryItemRow = ({ item, onClick, isSelected }) => (
            <button 
                onClick={() => onClick(item)}
                className={`w-full flex items-center gap-3 p-3 rounded-xl border transition-all active:scale-95 touch-manipulation
                    ${isSelected 
                    ? 'bg-slate-800 border-blue-500 ring-1 ring-blue-500' 
                    : 'bg-slate-900/50 border-slate-800 hover:bg-slate-800'}`}
            >
                <div className="w-10 h-10 flex-shrink-0 flex items-center justify-center text-2xl bg-slate-950 rounded-lg border border-slate-800">
                    {item.emoji}
                </div>
                <div className="flex-1 flex flex-col items-start">
                    <span className="text-sm font-bold text-slate-200">{item.name}</span>
                    <div className="flex gap-2 mt-0.5">
                        {Object.entries(item.stats).map(([key, val]) => (
                            <span key={key} className={`text-[10px] font-bold uppercase ${STATS[key].color} bg-slate-950/50 px-1.5 rounded`}>
                                {STATS[key].icon} {val > 0 ? '+' : ''}{val}
                            </span>
                        ))}
                    </div>
                </div>
                {isSelected && <div className="w-3 h-3 rounded-full bg-blue-500 shadow-lg shadow-blue-500/50"></div>}
            </button>
        );

        // Large Slot for Equipped Items
        const EquipSlot = ({ type, item, onClick }) => (
            <button 
                onClick={onClick}
                className={`relative flex flex-col items-center justify-center p-2 rounded-xl border-2 border-dashed transition-all active:scale-95 h-24
                ${item 
                    ? 'bg-slate-800 border-slate-600 border-solid shadow-md' 
                    : 'bg-slate-900/30 border-slate-800 text-slate-700'}`}
            >
                <div className="text-3xl mb-1">{item ? item.emoji : (type === ITEM_TYPES.WEAPON ? '‚öîÔ∏è' : type === ITEM_TYPES.HEAD ? 'üß¢' : type === ITEM_TYPES.OFFHAND ? 'üõ°Ô∏è' : 'üíç')}</div>
                <div className="text-[10px] font-bold uppercase tracking-wider truncate w-full text-center">
                    {item ? item.name : type}
                </div>
                {!item && <div className="absolute inset-0 flex items-center justify-center text-slate-700 opacity-20 text-4xl font-black select-none pointer-events-none">+</div>}
            </button>
        );

        function App() {
            // --- STATE ---
            const [view, setView] = useState('HOME');
            const [logs, setLogs] = useState(['Welcome. Gear up.']);
            
            // Player
            const [hp, setHp] = useState(50);
            const [maxHp, setMaxHp] = useState(50);
            const [xp, setXp] = useState(0);
            const [level, setLevel] = useState(1);
            
            // Inventory
            const [inventory, setInventory] = useState([ITEMS[0], ITEMS[2], ITEMS[5]]); 
            const [equipped, setEquipped] = useState({
                [ITEM_TYPES.WEAPON]: null,
                [ITEM_TYPES.OFFHAND]: null,
                [ITEM_TYPES.HEAD]: null,
                [ITEM_TYPES.ACC]: null,
            });
            const [selectedItem, setSelectedItem] = useState(null);

            // Combat
            const [currentEnemy, setCurrentEnemy] = useState(null);
            const [combatState, setCombatState] = useState('idle'); 

            // --- DERIVED STATS ---
            const totalStats = useMemo(() => {
                const base = { GRIT: 1, VIBE: 1, SPICE: 1, LUCK: 1 };
                Object.values(equipped).forEach(item => {
                    if (item) {
                        Object.entries(item.stats).forEach(([key, val]) => {
                            base[key] = (base[key] || 0) + val;
                        });
                    }
                });
                return base;
            }, [equipped]);

            const activeSynergies = useMemo(() => {
                const synergies = [];
                const allTags = Object.values(equipped).filter(i => i).flatMap(i => i.tags);
                
                if (allTags.filter(t => t === 'food').length >= 2) synergies.push({ name: 'Combo Meal', desc: 'Heal 2 HP/turn', id: 'food' });
                if (allTags.includes('cool') && allTags.includes('tech')) synergies.push({ name: 'Cyberpunk', desc: '+5 Vibe', id: 'cyber' });
                if (allTags.includes('spicy') && allTags.includes('metal')) synergies.push({ name: 'Hot Iron', desc: 'Burn dmg', id: 'hotiron' });
                
                if (synergies.find(s => s.id === 'cyber')) totalStats.VIBE += 5;
                return synergies;
            }, [equipped, totalStats]);

            // --- ACTIONS ---
            const addLog = (msg) => setLogs(prev => [msg, ...prev].slice(0, 20));

            const equipItem = (item) => {
                if (!item) return;
                const currentEquipped = equipped[item.type];
                setEquipped(prev => ({ ...prev, [item.type]: item }));
                let newInv = inventory.filter(i => i !== item);
                if (currentEquipped) newInv.push(currentEquipped);
                setInventory(newInv);
                setSelectedItem(null);
                addLog(`Equipped ${item.name}`);
            };

            const unequipItem = (type) => {
                const item = equipped[type];
                if (!item) return;
                setEquipped(prev => ({ ...prev, [type]: null }));
                setInventory(prev => [...prev, item]);
                addLog(`Unequipped ${item.name}`);
            };

            // Combat Logic
            const startCombat = () => {
                const enemyTemplate = ENEMIES[Math.floor(Math.random() * ENEMIES.length)];
                const enemy = { 
                    ...enemyTemplate, 
                    hp: enemyTemplate.hp + (level * 10),
                    maxHp: enemyTemplate.hp + (level * 10),
                    dmg: enemyTemplate.dmg + level 
                };
                setCurrentEnemy(enemy);
                setView('COMBAT');
                setCombatState('player_turn');
                addLog(`Wild ${enemy.name} appeared!`);
            };

            const handleAttack = () => {
                if (combatState !== 'player_turn' || !currentEnemy) return;
                const baseDmg = totalStats.GRIT * 2;
                const isCrit = Math.random() * 100 < (totalStats.SPICE * 5);
                const finalDmg = isCrit ? Math.floor(baseDmg * 2) : baseDmg;
                const newEnemyHp = currentEnemy.hp - finalDmg;
                
                addLog(`${isCrit ? 'CRIT!' : 'Hit'} ${currentEnemy.emoji} for ${finalDmg}`);

                if (newEnemyHp <= 0) {
                    setCurrentEnemy(null);
                    const xpGain = 20 + (totalStats.LUCK * 2);
                    setXp(prev => prev + xpGain);
                    if (xp + xpGain >= level * 100) setLevel(l => l + 1);
                    if (Math.random() < 0.5 + (totalStats.LUCK * 0.05)) {
                        const loot = ITEMS[Math.floor(Math.random() * ITEMS.length)];
                        setInventory(prev => [...prev, { ...loot, id: Date.now() }]); 
                        addLog(`Loot: ${loot.name}`);
                    }
                    setView('HOME');
                } else {
                    setCurrentEnemy(prev => ({ ...prev, hp: newEnemyHp }));
                    setCombatState('enemy_turn');
                    setTimeout(enemyAttack, 800);
                }
            };

            const enemyAttack = () => {
                if (!currentEnemy) return;
                if (Math.random() * 100 < (totalStats.LUCK * 2)) {
                    addLog(`Dodged attack!`);
                } else {
                    const dmg = currentEnemy.dmg;
                    setHp(prev => Math.max(0, prev - dmg));
                    addLog(`Took ${dmg} dmg`);
                }
                if (activeSynergies.find(s => s.id === 'food')) setHp(prev => Math.min(maxHp, prev + 2));
                setCombatState('player_turn');
            };

            useEffect(() => {
                if (hp <= 0 && view !== 'GAMEOVER') setView('GAMEOVER');
            }, [hp]);

            // --- VIEWS ---

            const TopBar = () => (
                <div className="bg-slate-900 pt-safe-top pb-2 px-4 shadow-lg z-10 shrink-0">
                    <div className="flex justify-between items-center mb-2 mt-2">
                        <h1 className="text-lg font-black italic text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">EMOJI DUNGEON</h1>
                        <div className="text-xs font-mono text-slate-500">LVL {level}</div>
                    </div>
                    
                    {/* New Prominent HP Bar */}
                    <div className="relative w-full h-6 bg-slate-800 rounded-full overflow-hidden border border-slate-700 shadow-inner">
                        <div 
                            className={`h-full transition-all duration-500 ease-out flex items-center justify-end px-2 ${hp < maxHp * 0.3 ? 'bg-red-600 animate-pulse' : 'bg-gradient-to-r from-red-500 to-red-600'}`}
                            style={{ width: `${(hp / maxHp) * 100}%` }}
                        >
                        </div>
                        <div className="absolute inset-0 flex items-center justify-center text-xs font-bold text-white drop-shadow-md">
                            {hp} / {maxHp} HP
                        </div>
                    </div>
                </div>
            );

            const InventoryView = () => (
                <div className="flex flex-col h-full overflow-hidden">
                    {/* Fixed Top: Paper Doll */}
                    <div className="bg-slate-900/50 p-4 border-b border-slate-800 shrink-0">
                        <div className="grid grid-cols-4 gap-2">
                            {[ITEM_TYPES.HEAD, ITEM_TYPES.WEAPON, ITEM_TYPES.OFFHAND, ITEM_TYPES.ACC].map(type => (
                                <EquipSlot 
                                    key={type} 
                                    type={type} 
                                    item={equipped[type]} 
                                    onClick={() => unequipItem(type)} 
                                />
                            ))}
                        </div>
                        {/* Stats Summary */}
                        <div className="flex justify-around mt-4 bg-slate-800/50 p-2 rounded-lg border border-slate-700/50">
                            {Object.keys(STATS).map(key => (
                                <div key={key} className="flex flex-col items-center">
                                    <span className="text-lg leading-none">{STATS[key].icon}</span>
                                    <span className={`text-xs font-bold ${STATS[key].color}`}>{totalStats[key]}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Scrollable Bottom: Backpack */}
                    <div className="flex-1 overflow-y-auto p-4 pb-32 overscroll-contain no-scrollbar">
                        <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 sticky top-0 bg-slate-950 py-2 z-10">Backpack</h3>
                        <div className="flex flex-col gap-2">
                            {inventory.map((item, idx) => (
                                <InventoryItemRow 
                                    key={item.id + idx} 
                                    item={item} 
                                    isSelected={selectedItem === item}
                                    onClick={setSelectedItem}
                                />
                            ))}
                            {inventory.length === 0 && <div className="text-center text-slate-600 py-10 italic">Empty bag...</div>}
                        </div>
                    </div>

                    {/* Floating Action Sheet for Selected Item */}
                    <div className={`absolute bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-700 p-4 pb-safe-bottom transform transition-transform duration-300 z-50 ${selectedItem ? 'translate-y-0' : 'translate-y-full'}`}>
                        {selectedItem && (
                            <div className="flex gap-3 items-center">
                                <div className="text-4xl bg-slate-800 p-2 rounded-lg">{selectedItem.emoji}</div>
                                <div className="flex-1">
                                    <div className="font-bold text-white">{selectedItem.name}</div>
                                    <div className="text-xs text-slate-400 uppercase">{selectedItem.type}</div>
                                </div>
                                <button 
                                    onClick={() => equipItem(selectedItem)}
                                    className="bg-blue-600 active:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-blue-900/20 flex items-center gap-2"
                                >
                                    Equip <span className="text-xl">‚á™</span>
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );

            const CombatView = () => (
                <div className="flex flex-col h-full p-4">
                    {/* Enemy Stage */}
                    <div className="flex-1 flex flex-col items-center justify-center relative pb-12">
                        <div className="text-8xl animate-bounce mb-6 filter drop-shadow-[0_10px_10px_rgba(0,0,0,0.5)]">{currentEnemy?.emoji}</div>
                        <div className="text-2xl font-black text-white tracking-tight">{currentEnemy?.name}</div>
                        
                        <div className="w-64 h-5 bg-slate-800 rounded-full overflow-hidden border-2 border-slate-700 mt-2">
                            <div className="h-full bg-red-500 transition-all duration-300" style={{ width: `${(currentEnemy.hp / currentEnemy.maxHp) * 100}%` }} />
                        </div>
                        <div className="mt-1 font-mono text-slate-400">{currentEnemy.hp} HP</div>

                        {/* Floating Combat Text / Status */}
                        {combatState === 'enemy_turn' && (
                            <div className="absolute top-10 bg-red-500/90 text-white px-4 py-1 rounded-full font-bold text-sm animate-pulse shadow-lg">
                                ATTACKING!
                            </div>
                        )}
                    </div>

                    {/* Combat Controls */}
                    <div className="grid grid-cols-2 gap-4 h-32 shrink-0 pb-safe-bottom">
                        <button 
                            onClick={handleAttack}
                            disabled={combatState !== 'player_turn'}
                            className="bg-red-600 active:bg-red-700 disabled:opacity-50 disabled:scale-100 text-white rounded-2xl font-black text-xl flex flex-col items-center justify-center gap-1 shadow-xl shadow-red-900/20 transition-transform active:scale-95"
                        >
                            <span className="text-3xl">‚öîÔ∏è</span>
                            SMASH
                        </button>
                        <button className="bg-slate-800 text-slate-500 rounded-2xl font-bold flex flex-col items-center justify-center gap-1 border border-slate-700 opacity-50">
                            <span className="text-3xl">üéí</span>
                            ITEM
                        </button>
                    </div>
                </div>
            );

            const HomeView = () => (
                <div className="flex flex-col items-center justify-center h-full p-6 pb-32 text-center">
                    <div className="w-32 h-32 bg-gradient-to-br from-slate-800 to-slate-900 rounded-[2rem] flex items-center justify-center text-6xl border-4 border-slate-700 mb-8 shadow-2xl shadow-purple-900/20 rotate-3 hover:rotate-0 transition-transform">
                        üßê
                    </div>
                    <h2 className="text-3xl font-black text-white mb-3">Into the Dark</h2>
                    <p className="text-slate-400 mb-10 leading-relaxed max-w-xs mx-auto">
                        Monsters lurk below. Your backpack is messy. <br/>Fix your vibe before you fight.
                    </p>
                    <button 
                        onClick={startCombat}
                        className="w-full max-w-xs bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-5 px-8 rounded-2xl shadow-lg shadow-purple-900/40 flex items-center justify-center gap-3 text-xl active:scale-95 transition-transform"
                    >
                        <span>üíÄ</span> ENTER
                    </button>
                </div>
            );

            return (
                <div className="h-[100dvh] w-full max-w-md mx-auto bg-slate-950 flex flex-col relative shadow-2xl overflow-hidden">
                    <TopBar />
                    
                    {/* Main Content Area */}
                    <main className="flex-1 overflow-hidden relative bg-slate-950">
                        {view === 'HOME' && <HomeView />}
                        {view === 'INVENTORY' && <InventoryView />}
                        {view === 'COMBAT' && <CombatView />}
                        {view === 'GAMEOVER' && (
                            <div className="absolute inset-0 z-50 bg-slate-950/90 flex flex-col items-center justify-center p-8 text-center backdrop-blur-sm">
                                <div className="text-8xl mb-4 animate-bounce">üíÄ</div>
                                <h2 className="text-4xl font-black text-red-500 mb-2">YOU DIED</h2>
                                <button onClick={() => window.location.reload()} className="mt-8 bg-white text-black px-8 py-4 rounded-full font-bold text-lg shadow-xl active:scale-95">
                                    Try Again
                                </button>
                            </div>
                        )}
                    </main>

                    {/* Log Ticker */}
                    {view !== 'INVENTORY' && (
                         <div className="h-8 bg-slate-900 flex items-center px-4 border-t border-slate-800 shrink-0 overflow-hidden whitespace-nowrap">
                            <span className="text-xs font-mono text-slate-400 opacity-75 mr-2">LOG:</span>
                            <span className="text-xs font-mono text-white">{logs[0]}</span>
                        </div>
                    )}

                    {/* Navigation Bar */}
                    <nav className="bg-slate-900 border-t border-slate-800 flex justify-around p-2 pb-safe-bottom shrink-0 z-40">
                        <button 
                            onClick={() => view !== 'COMBAT' && setView('HOME')} 
                            disabled={view === 'COMBAT'}
                            className={`flex-1 flex flex-col items-center p-2 rounded-xl transition-all ${view === 'HOME' ? 'bg-slate-800 text-blue-400' : 'text-slate-500'} ${view === 'COMBAT' ? 'opacity-20 grayscale' : ''}`}
                        >
                            <span className="text-2xl mb-1">üß≠</span>
                            <span className="text-[10px] font-bold uppercase">Explore</span>
                        </button>
                        
                        <div className="w-px bg-slate-800 my-2"></div>

                        <button 
                            onClick={() => view !== 'COMBAT' && setView('INVENTORY')} 
                            disabled={view === 'COMBAT'}
                            className={`flex-1 flex flex-col items-center p-2 rounded-xl transition-all ${view === 'INVENTORY' ? 'bg-slate-800 text-purple-400' : 'text-slate-500'} ${view === 'COMBAT' ? 'opacity-20 grayscale' : ''}`}
                        >
                            <div className="relative">
                                <span className="text-2xl mb-1">üéí</span>
                                {inventory.length > 0 && <div className="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-slate-900"></div>}
                            </div>
                            <span className="text-[10px] font-bold uppercase">Gear</span>
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
