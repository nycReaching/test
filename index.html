<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Pro Game UI Update - Zones</title>
    <style>
        /* --- RESET & VARIABLES --- */
        :root {
            --ui-gold: #FFD700;
            --ui-gold-dark: #FFA000;
            --ui-purple: #9C27B0;
            --ui-purple-dark: #4A148C;
            --ui-red: #D32F2F;
            --ui-red-dark: #B71C1C;
            --ui-teal: #00BCD4;
            --ui-teal-dark: #006064;
            --ui-brown: #5D4037;
            --ui-brown-dark: #3E2723;
            --ui-dark: #1a1a1a;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --app-height: 100vh;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100dvh;
            height: var(--app-height); 
            overflow: hidden;
            font-family: var(--font-main);
            background-color: #111; 
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- MASTER CONTAINER --- */
        #game-viewport {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 550px; 
            background: black;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            container-type: size; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #game-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; 
            background: linear-gradient(180deg, #b2ff59 0%, #0d380d 90%);
            background-image: 
                linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px),
                linear-gradient(180deg, #b2ff59 0%, #002b00 100%);
            background-size: 30px 30px, 30px 30px, cover;
        }

        /* --- ZONES CONFIGURATION --- 
           These are the 4 main areas. They are positioned absolutely,
           but their contents are managed by flex/grid for stability.
        */
        .placement-zone {
            position: absolute;
            z-index: 5;
            /* Debug styling for visualization */
            border: 2px dashed rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.05);
            border-radius: 2cqw;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .zone-label {
            position: absolute;
            top: -3cqw;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: 2.5cqw;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            pointer-events: none;
            white-space: nowrap;
        }

        /* ZONE 1: ITEMS COLUMN (Center) */
        #zone-items {
            top: 12%;
            left: 50%;
            transform: translateX(-50%) skewX(-12deg); /* Global skew for the column */
            width: 25%;
            height: 45%;
            flex-direction: column;
            justify-content: flex-start;
            gap: 2cqw;
            padding-top: 2cqw;
            border-color: rgba(0, 188, 212, 0.3); /* Teal hint */
        }

        /* Slots inside the item zone */
        .item-slot-placeholder {
            width: 80%;
            aspect-ratio: 1;
            border-radius: 1.5cqw;
            background: rgba(255,255,255,0.1);
            border: 1px dotted rgba(255,255,255,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 4cqw;
            color: rgba(255,255,255,0.3);
            /* Counter-skew the content so emojis stand straight */
            transform: skewX(12deg); 
        }

        /* ZONE 2: GARDEN (Mid Right) */
        #zone-garden {
            top: 25%;
            right: 5%;
            width: 25%;
            height: 30%;
            flex-direction: column;
            justify-content: flex-end; /* Grow from bottom up */
            gap: 1cqw;
            border-color: rgba(139, 195, 74, 0.3); /* Green hint */
        }

        .garden-row {
            display: flex;
            width: 100%;
            justify-content: space-evenly;
        }
        
        .garden-slot {
            width: 30%;
            aspect-ratio: 1;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            border: 1px dotted rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3cqw;
            color: rgba(255,255,255,0.2);
        }

        /* ZONE 3: TREES (Bottom Left) */
        #zone-trees {
            bottom: 28%; /* Just above footer area */
            left: 5%;
            width: 40%;
            height: 25%;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            border-color: rgba(121, 85, 72, 0.3); /* Brown hint */
            /* Remove skew for trees usually, or keep consistent style? 
               Let's keep trees straight/flat for organic feel */
        }
        
        .tree-slot {
            width: 30%;
            height: 100%;
            background: linear-gradient(to top, rgba(255,255,255,0.1) 0%, transparent 80%);
            border-bottom: 2px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 1cqw;
            font-size: 15cqw; /* Large placeholder size */
            opacity: 0.5;
        }

        /* ZONE 4: FLOWERS (Bottom Right) */
        #zone-flowers {
            bottom: 28%;
            right: 5%;
            width: 45%;
            height: 20%;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            align-items: end;
            border-color: rgba(233, 30, 99, 0.3); /* Pink hint */
        }

        .flower-slot {
            width: 100%;
            height: 60%; /* Flowers are short */
            border-bottom: 1px dotted rgba(255,255,255,0.3);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            font-size: 6cqw;
            opacity: 0.4;
        }


        /* --- SHARED STYLES (Preserved from original) --- */
        .panel {
            box-shadow: 0 1cqw 1.5cqw rgba(0,0,0,0.6);
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-pressable {
            transition: transform 0.1s, filter 0.1s;
            cursor: pointer;
        }
        .btn-pressable:active {
            transform: scale(0.95);
            filter: brightness(0.9);
        }

        /* --- 1. TOP LEFT: PLAYER STATS --- */
        .ui-stats-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 65%;
            height: 8%;
            background: linear-gradient(135deg, var(--ui-gold) 0%, var(--ui-gold-dark) 100%);
            clip-path: polygon(0 0, 100% 0, 95% 100%, 0% 100%);
            display: flex;
            justify-content: space-between; 
            align-items: center;
            padding-left: 4cqw;
            padding-right: 10cqw; 
            z-index: 20;
            filter: drop-shadow(0 1cqw 1cqw rgba(0,0,0,0.5));
        }

        .stat-group {
            display: flex;
            flex-direction: column;
            line-height: 1;
            justify-content: center;
            align-items: center; 
        }

        .stat-label { 
            font-size: 2.5cqw; 
            opacity: 0.8; 
            color: #443300;
            text-transform: uppercase; 
        }
        .stat-value { 
            font-size: 4cqw; 
            font-weight: 800;
        }
        .stat-funds { color: #006400; } 
        .stat-day { color: #5D4037; }
        .stat-luck { color: #C2185B; } 


        /* --- 2. TOP RIGHT: ENEMY PROGRESS --- */
        .ui-event-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: 30%;
            height: auto; 
            min-height: 42%; 
            background: linear-gradient(180deg, #d32f2f 0%, #5d0000 100%);
            border-bottom-left-radius: 4cqw;
            border-left: 0.5cqw solid rgba(255,255,255,0.2);
            border-bottom: 0.5cqw solid rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-evenly; 
            padding-top: 2cqw; 
            padding-bottom: 3cqw;
            gap: 1.5cqw; 
            z-index: 20;
            box-shadow: -1cqw 1cqw 2cqw rgba(0,0,0,0.6);
        }

        .enemy-header {
            font-size: 2.5cqw; 
            opacity: 0.9;
            color: white;
            text-transform: uppercase;
            font-weight: 400; /* Thin/Regular weight */
            margin-bottom: 0;
            letter-spacing: 0.05cqw;
            text-shadow: 0 0.2cqw 0.5cqw rgba(0,0,0,0.3);
        }

        .meter-group {
            width: 85%;
            display: flex;
            flex-direction: column;
            gap: 1.5cqw; 
            background: transparent; 
            padding: 0; 
            border-radius: 1.5cqw;
        }

        .meter-container {
            width: 100%;
            display: flex;
            flex-direction: row; 
            gap: 2cqw;
            align-items: center;
            justify-content: center;
        }

        .meter-icon {
            font-size: 7cqw; 
            width: 7cqw;
            text-align: center;
            filter: drop-shadow(0 0.2cqw 0.2cqw rgba(0,0,0,0.6));
        }

        .meter-bar {
            flex-grow: 1;
            height: 2.2cqw; 
            background: rgba(0,0,0,0.4);
            border-radius: 1cqw;
            border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            border-radius: 1cqw;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .fill-red { background: #ff5252; width: 85%; }
        .fill-orange { background: #ff9800; width: 45%; }
        .fill-grey { background: #90a4ae; width: 20%; }

        .sabotage-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            gap: 1cqw;
            margin-top: 2cqw; 
        }

        .sabotage-label {
            font-size: 2.5cqw; 
            opacity: 0.9;
            color: white;
            text-transform: uppercase;
            font-weight: 400; 
        }

        .neighbor-slots-row {
            display: flex;
            gap: 2cqw;
            margin-bottom: 0;
            margin-top: 0.5cqw; 
        }

        .neighbor-slot {
            width: 12cqw; 
            aspect-ratio: 1;
            background: rgba(0,0,0,0.2);
            border: none; 
            border-radius: 2cqw;
            box-shadow: inset 0 0.5cqw 1cqw rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 7cqw; 
        }

        /* --- 3. LEFT SIDEBAR --- */
        .ui-sidebar-container {
            position: absolute;
            top: 15%;
            left: 0;
            width: 15%; 
            height: 60%; 
            display: flex;
            flex-direction: column;
            gap: 2cqw;
            padding-left: 1cqw;
            z-index: 30;
            pointer-events: none; 
        }

        .sidebar-item-wrapper {
            position: relative;
            width: 100%;
            pointer-events: auto;
            display: flex;
            align-items: center;
        }

        .side-btn {
            width: 100%;
            aspect-ratio: 1; 
            background: linear-gradient(135deg, var(--ui-purple) 0%, var(--ui-purple-dark) 100%);
            border-radius: 2cqw;
            border: 0.3cqw solid rgba(255,255,255,0.3);
            border-left: none;
            box-shadow: 1cqw 1cqw 1.5cqw rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 6cqw;
            position: relative;
            z-index: 2;
        }

        /* --- SLIDE OUT MENU --- */
        .slide-menu {
            position: absolute;
            left: 90%; 
            top: 0;
            height: 100%;
            background: rgba(40, 20, 60, 0.95);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 0 2cqw 2cqw 0;
            display: flex;
            align-items: center;
            padding: 0;
            gap: 0;
            width: 0;
            opacity: 0;
            overflow: hidden;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 1; 
            box-shadow: 1cqw 1cqw 2cqw rgba(0,0,0,0.4);
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .slide-menu::-webkit-scrollbar { display: none; }

        .slide-menu.open {
            opacity: 1;
            padding: 0 2cqw 0 3cqw; 
            pointer-events: auto;
            left: 85%;
        }

        .menu-trees.open { width: 50cqw; }
        .menu-flowers.open { width: 65cqw; } 
        .menu-farmer.open { width: 40cqw; }

        .menu-option {
            font-size: 6cqw;
            padding: 1cqw;
            cursor: pointer;
            transition: transform 0.2s;
            flex: 1;
            min-width: 8cqw;
            text-align: center;
            display: inline-block;
        }
        .menu-option:active {
            transform: scale(0.8);
        }

        /* --- 4. BOTTOM AREA --- */
        .ui-footer-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 28%; 
            z-index: 30;
            display: flex;
            flex-direction: column;
            box-shadow: none;
            overflow: visible; 
            pointer-events: none; /* Let clicks pass through empty spaces */
        }
        
        .ui-footer-container > * {
            pointer-events: auto; /* Re-enable for children */
        }

        .ui-inventory-strip {
            /* Positioning: Inside footer now (top 2cqw), centered horizontally */
            position: absolute;
            top: 2cqw; 
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;

            width: 92%;
            margin: 0;
            height: 18%; 
            border-radius: 10cqw;
            
            /* Styles matched to Dice Button (#btn-dice) */
            background: linear-gradient(to bottom, #D81B60, #880E4F); 
            
            /* Border will be animated in JS */
            border: 0.5cqw solid rgba(255,255,255,0.3);
            
            box-shadow: 0 1cqw 2cqw rgba(0,0,0,0.6);
            
            display: flex;
            align-items: center;
            padding: 0 2cqw;
            justify-content: space-evenly;
            gap: 0; 
            overflow: hidden; 
            
            transition: transform 0.1s;
        }
        
        .ui-inventory-strip::-webkit-scrollbar { display: none; }

        .inv-slot {
            height: 75%; 
            aspect-ratio: 1;
            background: transparent;
            border: none;
            box-shadow: none;
            display: flex;
            justify-content: center;
            align-items: center;
            color: rgba(255,255,255,0.5); 
            font-weight: bold;
            font-size: 6cqw; 
            flex-shrink: 0;
            transition: all 0.1s ease;
            text-shadow: 0 0.2cqw 0.5cqw rgba(0,0,0,0.3);
        }
        
        /* Active slot style logic - bright yellow on pink */
        .inv-slot.active { 
            color: #FFD700; 
            transform: scale(1.6); 
            text-shadow: 0 0 2cqw #FFD700, 0 0 4cqw rgba(255, 100, 0, 0.5);
            opacity: 1;
        }

        .ui-controls-main {
            flex-grow: 1;
            /* Lightened Midnight Blue Gradient */
            background: linear-gradient(180deg, #0d2b4d 0%, #000000 100%);
            
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            
            /* Padding pushed down to make room for the inventory strip at the top */
            padding-top: 10cqw;
        }

        .camera-row {
            display: flex;
            align-items: center;
            gap: 3cqw; 
        }

        /* --- BUTTONS --- */
        .secondary-action-btn {
            width: 25cqw; 
            aspect-ratio: 1.8 / 1; 
            border-radius: 10cqw; 
            border: 0.5cqw solid rgba(255,255,255,0.3);
            box-shadow: 0 1cqw 2cqw rgba(0,0,0,0.6);
            color: white;
            font-size: 7cqw;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 0.5cqw;
        }

        .btn-blue {
            background: linear-gradient(to bottom, #1565C0, #0D47A1); 
        }

        .btn-pink-gradient {
            background: linear-gradient(to bottom, #D81B60, #880E4F); 
        }

        .main-action-btn {
            width: 35cqw;
            aspect-ratio: 2.2 / 1;
            background: linear-gradient(to bottom, var(--ui-teal), var(--ui-teal-dark));
            border-radius: 10cqw;
            border: 0.5cqw solid rgba(255,255,255,0.3);
            box-shadow: 0 1cqw 2cqw rgba(0,0,0,0.6);
            color: white;
            font-size: 9cqw;
            text-transform: uppercase;
            letter-spacing: 0.5cqw;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 2.5cqw; 
        }

        /* --- SHARED MODAL STYLES --- */
        .modal-base {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 90%; /* Widened for Shop Columns */
            height: 75%; /* Taller for Shop Headers */
            
            transform: translate(-50%, -50%) scale(0.9);
            
            border: 0.5cqw solid rgba(255,255,255,0.3);
            border-radius: 4cqw;
            box-shadow: 0 2cqw 4cqw rgba(0,0,0,0.8);
            
            z-index: 100;
            display: flex;
            flex-direction: column; /* Changed to column for top/bottom split */
            
            color: white;
            font-size: 4cqw;
            
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }
        
        .modal-base.open {
            opacity: 1;
            pointer-events: auto;
            transform: translate(-50%, -50%) scale(1);
        }

        .shop-modal-style {
            background: linear-gradient(135deg, #1565C0, #0D47A1); 
        }
        
        /* SELF MODAL & SUMMARY MODAL SPECIFICS */
        .self-content {
            padding: 6cqw;
            display: flex;
            flex-direction: column;
            gap: 4cqw;
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }

        .self-stat-row {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.2);
            padding: 2cqw;
            border-radius: 2cqw;
        }
        .stat-item { display: flex; flex-direction: column; align-items: center; }
        .stat-item span:first-child { font-size: 3cqw; opacity: 0.8; margin-bottom: 1cqw; }
        .stat-item span:last-child { font-size: 5cqw; font-weight: bold; }
        
        .self-section {
            background: rgba(0,0,0,0.2);
            padding: 3cqw;
            border-radius: 2cqw;
        }
        .self-label { font-size: 3.5cqw; opacity: 0.9; margin-bottom: 1cqw; display: block; font-weight: bold; color: var(--ui-gold); }
        .self-value { opacity: 0.6; font-style: italic; }

        .summary-btn {
            width: 100%;
            padding: 3cqw;
            background: linear-gradient(to right, #00BCD4, #006064);
            border: none;
            border-radius: 2cqw;
            color: white;
            font-weight: bold;
            font-size: 4cqw;
            box-shadow: 0 1cqw 1cqw rgba(0,0,0,0.4);
            margin-top: auto; /* Push to bottom */
            text-align: center;
        }

        /* NEW SELF BUTTONS */
        .self-btn-row {
            display: flex;
            gap: 2cqw;
            width: 100%;
        }
        .self-action-btn {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 2cqw;
            padding: 2cqw 0.5cqw;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5cqw;
            font-weight: bold;
            box-shadow: 0 0.5cqw 1cqw rgba(0,0,0,0.2);
            text-align: center;
            white-space: nowrap;
        }


        .summary-modal-style {
            background: linear-gradient(160deg, #2E7D32, #1B5E20);
            padding: 6cqw;
            font-size: 3.5cqw;
            line-height: 1.5;
            overflow-y: auto;
            text-align: left;
        }
        .summary-modal-style p { margin-bottom: 4cqw; }
        .summary-modal-style strong { color: var(--ui-gold); }


        /* SHOP LAYOUT */
        .shop-section-header {
            width: 100%;
            background: rgba(0,0,0,0.3);
            color: var(--ui-gold);
            text-transform: uppercase;
            font-size: 3cqw;
            letter-spacing: 0.2cqw;
            padding: 1.5cqw;
            text-align: center;
            font-weight: bold;
            border-top: 1px solid rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        .shop-top-half {
            width: 100%;
            flex-grow: 1.5; /* Takes up more space */
            display: flex;
            flex-direction: row;
            background: rgba(0,0,0,0.1);
            min-height: 0; /* allows flex scroll */
        }
        
        .shop-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.1);
            align-items: center;
            padding: 1cqw;
        }
        .shop-column:last-child { border-right: none; }
        
        .shop-header {
            /* Matches .enemy-header EXACTLY */
            font-size: 2.5cqw; 
            opacity: 0.9;
            color: white;
            text-transform: uppercase;
            font-weight: 400; /* Thin/Regular weight */
            margin-bottom: 1cqw;
            letter-spacing: 0.05cqw;
            text-shadow: 0 0.2cqw 0.5cqw rgba(0,0,0,0.3);
            
            height: 10%;
            display: flex;
            align-items: center;
            text-align: center;
        }
        
        .shop-items-container {
            display: flex;
            flex-direction: column;
            gap: 1.5cqw;
            width: 100%;
            height: 90%;
            align-items: center;
            justify-content: flex-start; /* Ensure items stack from top */
            padding-top: 1cqw;
        }
        
        /* Updated Shop Item Style */
        .shop-item-style {
            /* 30% Smaller from 80% is approx 55% */
            width: 55%;
            aspect-ratio: 1;
            border-radius: 1.5cqw;
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0.5cqw 0.5cqw 1cqw rgba(0,0,0,0.5);
            /* Skewed container */
            transform: skewX(-12deg);
            position: relative; /* Needed for absolute positioning of price/ID */
        }
        
        .shop-item-style .inner-emoji {
            /* Counter-skew emoji */
            transform: skewX(12deg);
            font-size: 7cqw; 
            line-height: 1;
        }

        .shop-price {
            position: absolute;
            bottom: -8%;
            left: -8%;
            color: var(--ui-gold);
            font-size: 3.5cqw;
            font-weight: 900;
            transform: skewX(12deg);
            z-index: 10;
            text-shadow: 0 2px 2px rgba(0,0,0,0.8);
        }

        .shop-id {
            position: absolute;
            bottom: -5%;
            right: -8%;
            color: white;
            font-size: 5cqw; /* INCREASED */
            font-weight: 900;
            transform: skewX(12deg);
            z-index: 10;
            opacity: 0.95;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }
        
        .item-col-1 { background: #283593; } /* Matches Telescope Blue */
        .item-col-2 { background: #00ACC1; } /* Matches Bathtub Teal */
        .item-col-3 { background: #5D4037; } /* Matches Scales Brown */

        .shop-bottom-half {
            width: 100%;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0.5;
            font-size: 3cqw;
            min-height: 0;
        }

        .book-modal-style {
            background: linear-gradient(135deg, var(--ui-purple), var(--ui-purple-dark)); 
        }

        /* PAGINATION FOR BOOK */
        .book-page {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bird-collection-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1cqw;
            width: 95%;
            padding: 2cqw;
            justify-items: center;
            align-items: center;
        }

        .bird-unknown {
            font-size: 11cqw;
            filter: brightness(0); 
            opacity: 0.6;
            cursor: help;
            transition: transform 0.2s;
        }
        
        .bird-unknown:hover {
            transform: scale(1.2);
            opacity: 0.8;
        }

        .modal-nav-btn {
            position: absolute;
            bottom: 2cqw;
            right: 3cqw;
            font-size: 6cqw;
            cursor: pointer;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
            transition: transform 0.1s;
            z-index: 101;
        }
        .modal-nav-btn:active {
            transform: scale(0.9);
        }
        
        
    </style>
</head>
<body>

    <div id="game-viewport">
        
        <div id="game-background"></div>

        <!-- === ZONES START === -->
        
        <!-- ZONE 1: ITEMS COLUMN (Center Stack) -->
        <div id="zone-items" class="placement-zone">
            <div class="zone-label">Items</div>
            <!-- Theoretical Max: 4 items vertically -->
            <div class="item-slot-placeholder">üî≠</div>
            <div class="item-slot-placeholder">üõÅ</div>
            <div class="item-slot-placeholder">‚öñÔ∏è</div>
            <div class="item-slot-placeholder"></div>
        </div>

        <!-- ZONE 2: GARDEN (Mid Right, Grid/Cluster) -->
        <div id="zone-garden" class="placement-zone">
            <div class="zone-label">Garden</div>
            <div class="garden-row">
                <div class="garden-slot"></div>
                <div class="garden-slot">üå±</div>
                <div class="garden-slot"></div>
            </div>
            <div class="garden-row">
                <div class="garden-slot">üå±</div>
                <div class="garden-slot">ü™±</div>
                <div class="garden-slot">üå±</div>
            </div>
        </div>

        <!-- ZONE 3: TREES (Bottom Left Row) -->
        <div id="zone-trees" class="placement-zone">
            <div class="zone-label">Forest</div>
            <!-- Theoretical Max: 3 Trees -->
            <div class="tree-slot">üå≥</div>
            <div class="tree-slot">üå≤</div>
            <div class="tree-slot">üéã</div>
        </div>

        <!-- ZONE 4: FLOWERS (Bottom Right Grid) -->
        <div id="zone-flowers" class="placement-zone">
            <div class="zone-label">Flowers</div>
            <!-- Theoretical Max: 5 Flowers -->
            <div class="flower-slot">ü™ª</div>
            <div class="flower-slot">üåª</div>
            <div class="flower-slot">üåπ</div>
            <div class="flower-slot">üåº</div>
            <div class="flower-slot">üå∑</div>
        </div>

        <!-- === ZONES END === -->


        <!-- MODALS -->
        <div id="shop-modal" class="modal-base shop-modal-style">
            
            <div class="shop-section-header">Bird Supplies</div>
            
            <div class="shop-top-half">
                <!-- Column 1 -->
                <div class="shop-column">
                    <div class="shop-header">Bird<br>Houses</div>
                    <div class="shop-items-container">
                        <div class="shop-item-style item-col-1">
                            <div class="inner-emoji">üè†</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">2</div>
                        </div>
                        <div class="shop-item-style item-col-1">
                            <div class="inner-emoji">üõñ</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">8</div>
                        </div>
                        <div class="shop-item-style item-col-1">
                            <div class="inner-emoji">üèØ</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">5</div>
                        </div>
                    </div>
                </div>
                <!-- Column 2 -->
                <div class="shop-column">
                    <div class="shop-header">Bird<br>Baths</div>
                    <div class="shop-items-container">
                        <div class="shop-item-style item-col-2">
                            <div class="inner-emoji">‚õ≤</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">3</div>
                        </div>
                        <div class="shop-item-style item-col-2">
                            <div class="inner-emoji">üõÅ</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">1</div>
                        </div>
                        <div class="shop-item-style item-col-2">
                            <div class="inner-emoji">üöø</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">9</div>
                        </div>
                    </div>
                </div>
                <!-- Column 3 -->
                <div class="shop-column">
                    <div class="shop-header">Bird<br>Feeders</div>
                    <div class="shop-items-container">
                        <div class="shop-item-style item-col-3">
                            <div class="inner-emoji">üåΩ</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">4</div>
                        </div>
                        <div class="shop-item-style item-col-3">
                            <div class="inner-emoji">ü•Ø</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">7</div>
                        </div>
                        <div class="shop-item-style item-col-3">
                            <div class="inner-emoji">ü•ñ</div>
                            <div class="shop-price">$5</div>
                            <div class="shop-id">6</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="shop-section-header">Variety Shop</div>

            <div class="shop-bottom-half">
                (Empty Bottom Half)
            </div>
        </div>

        <div id="book-modal" class="modal-base book-modal-style">
            <!-- PAGE 1 -->
            <div id="book-page-1" class="book-page">
                <div class="bird-collection-grid">
                    <!-- Row 1 -->
                    <div class="bird-unknown">üêì</div>
                    <div class="bird-unknown">ü¶É</div>
                    <div class="bird-unknown">ü¶Ü</div>
                    <div class="bird-unknown">ü¶Ö</div>
                    <div class="bird-unknown">üïäÔ∏è</div>
                    <div class="bird-unknown">ü¶¢</div>
                    <!-- Row 2 -->
                    <div class="bird-unknown">ü¶ú</div>
                    <div class="bird-unknown">üê¶‚Äç‚¨õ</div>
                    <div class="bird-unknown">ü™ø</div>
                    <div class="bird-unknown">üê¶‚Äçüî•</div>
                    <div class="bird-unknown">ü¶©</div>
                    <div class="bird-unknown">ü¶ö</div>
                    <!-- Row 3 -->
                    <div class="bird-unknown">ü¶â</div>
                    <div class="bird-unknown">ü¶§</div>
                    <div class="bird-unknown">üê¶</div>
                    <div class="bird-unknown">üêß</div>
                    <div class="bird-unknown">üê•</div>
                    <div class="bird-unknown">üê£</div>
                </div>
            </div>

            <!-- PAGE 2 (Empty) -->
            <div id="book-page-2" class="book-page" style="display: none;">
                <div class="shop-title">PAGE 2</div>
            </div>

            <!-- Navigation Button -->
            <div class="modal-nav-btn" id="book-nav-btn">‚≠ê</div>
        </div>
        
        <!-- SELF MODAL (Updated) -->
        <div id="self-modal" class="modal-base book-modal-style">
            <div class="self-content">
                <div class="self-stat-row">
                    <div class="stat-item">
                        <span>CONFIDENCE</span>
                        <span style="color: #4CAF50;">4</span>
                    </div>
                    <div class="stat-item">
                        <span>INSECURITY</span>
                        <span style="color: #F44336;">3</span>
                    </div>
                    <div class="stat-item">
                        <span>TOXICITY</span>
                        <span style="color: #E91E63;">5</span>
                    </div>
                </div>

                <div class="self-section">
                    <span class="self-label">Run History</span>
                    <span class="self-value">(empty)</span>
                </div>

                <div class="self-section">
                    <span class="self-label">Settings</span>
                    <span class="self-value">(empty)</span>
                </div>

                <!-- NEW BUTTONS ROW -->
                <div class="self-btn-row">
                    <div class="self-action-btn btn-pressable">üç∫ Bar</div>
                    <div class="self-action-btn btn-pressable">üé∞ Casino</div>
                    <div class="self-action-btn btn-pressable">Therapist üëî</div>
                </div>

                <div class="summary-btn btn-pressable" id="btn-open-summary">
                    Game Summary
                </div>
            </div>
        </div>

        <!-- NEW GAME SUMMARY MODAL -->
        <div id="summary-modal" class="modal-base summary-modal-style">
            <p><strong>Backyard Birding</strong> is a roguelike creature collector where the player aims to outshine their bird-enthusiast neighbor by setting up the ultimate environment to snap pictures of unique and rare birds.</p>
            <p><strong>Backyard Birding</strong> is designed to have a sandbox-like feel, rewarding experimentation and creative builds. There are 18 birds to discover and over 10 rare visitors. Players can shape their runs towards an aggressive pace to try and beat the neighbor, or safe builds to chip away at unlocks, or go for all-or-nothing runs aimed for finding specific, rare birds.</p>
            <div style="text-align:center; margin-top: 6cqw; font-size: 3cqw; opacity: 0.6;">(Tap outside to close)</div>
        </div>


        <div class="ui-stats-bar">
            <!-- Align Left: DAY -->
            <div class="stat-group">
                <span class="stat-label">DAY</span>
                <span class="stat-value stat-day">1</span>
            </div>
            <!-- Align Center: FUNDS -->
            <div class="stat-group">
                <span class="stat-label">FUNDS</span>
                <span class="stat-value stat-funds">$1,000</span>
            </div>
            <!-- Align Right: LUCK -->
            <div class="stat-group">
                <span class="stat-label">LUCK</span>
                <span class="stat-value stat-luck">3</span>
            </div>
        </div>

        <div class="ui-event-panel panel">
            <!-- Matching FUNDS style: thin, clean, white -->
            <div class="enemy-header">Neighbor</div>
            
            <div class="meter-group">
                <div class="meter-container">
                    <div class="meter-icon">üìà</div>
                    <div class="meter-bar"><div class="meter-fill fill-red"></div></div>
                </div>

                <div class="meter-container">
                    <div class="meter-icon">üëé</div>
                    <div class="meter-bar"><div class="meter-fill fill-orange"></div></div>
                </div>

                <div class="meter-container">
                    <div class="meter-icon">üöò</div>
                    <div class="meter-bar"><div class="meter-fill fill-grey"></div></div>
                </div>
            </div>

            <div class="sabotage-section">
                <!-- Matching FUNDS style: thin, clean, white -->
                <div class="sabotage-label">Sabotage</div>
                <div class="neighbor-slots-row">
                    <div class="neighbor-slot">üêà</div>
                    <!-- ADDED MAILBOX HERE -->
                    <div class="neighbor-slot">üì¨</div>
                </div>
            </div>
        </div>

        <div class="ui-sidebar-container">
            <div class="sidebar-item-wrapper">
                <div class="side-btn btn-pressable" id="btn-book">üìö</div>
            </div>
            <div class="sidebar-item-wrapper">
                <div class="side-btn btn-pressable" id="btn-self">üë§</div>
            </div>
            
            <!-- Farmer Button Wrapper with Slide Out Menu -->
            <div class="sidebar-item-wrapper">
                <div class="side-btn btn-pressable" id="btn-farmer-toggle">üßë‚Äçüåæ</div>
                
                <div class="slide-menu menu-farmer" id="farmer-menu">
                    <div class="menu-option">üå±</div>
                    <div class="menu-option">ü™¥</div>
                    <div class="menu-option">ü™±</div>
                </div>
            </div>

            <!-- Flower Button Wrapper with Slide Out Menu -->
            <div class="sidebar-item-wrapper">
                <div class="side-btn btn-pressable" id="btn-flower-toggle">üå∑</div>
                
                <div class="slide-menu menu-flowers" id="flower-menu">
                    <div class="menu-option">üåπ</div>
                    <div class="menu-option">üå∫</div>
                    <div class="menu-option">üåª</div>
                    <div class="menu-option">üå∑</div>
                    <div class="menu-option">ü™ª</div>
                </div>
            </div>
            
            <!-- Tree Button Wrapper with Slide Out Menu -->
            <div class="sidebar-item-wrapper">
                <div class="side-btn btn-pressable" id="btn-tree-toggle">üå≥</div>
                
                <div class="slide-menu menu-trees" id="tree-menu">
                    <div class="menu-option">üå≥</div>
                    <div class="menu-option">üå≤</div>
                    <div class="menu-option">üå¥</div>
                    <div class="menu-option">üéã</div>
                </div>
            </div>
        </div>

        <div class="ui-footer-container">
            
            <div class="ui-inventory-strip">
                <div class="inv-slot active">1</div>
                <div class="inv-slot">2</div>
                <div class="inv-slot">3</div>
                <div class="inv-slot">4</div>
                <div class="inv-slot">5</div>
                <div class="inv-slot">6</div>
            </div>

            <div class="ui-controls-main">
                
                <div class="camera-row">
                    <!-- Shop Button -->
                    <div class="secondary-action-btn btn-blue btn-pressable" id="btn-shop">üè™</div>
                    
                    <div class="main-action-btn btn-pressable">
                        üì∑
                    </div>
                    
                    <div class="secondary-action-btn btn-pink-gradient btn-pressable" id="btn-dice">üé≤</div>
                </div>
            </div>
        </div>

    </div>

    <script>
        function setAppHeight() {
            const vh = window.innerHeight;
            document.documentElement.style.setProperty('--app-height', `${vh}px`);
        }
        
        window.addEventListener('resize', setAppHeight);
        setAppHeight();

        // Generic Button Press Animation
        document.querySelectorAll('.btn-pressable').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const targetEl = e.currentTarget;
                const originalTransform = targetEl.style.transform;
                targetEl.style.transform = "scale(0.9)";
                setTimeout(() => {
                    targetEl.style.transform = originalTransform;
                }, 100);
            });
        });

        // --- MENU LOGIC ---
        const treeBtn = document.getElementById('btn-tree-toggle');
        const treeMenu = document.getElementById('tree-menu');
        const flowerBtn = document.getElementById('btn-flower-toggle');
        const flowerMenu = document.getElementById('flower-menu');
        const farmerBtn = document.getElementById('btn-farmer-toggle');
        const farmerMenu = document.getElementById('farmer-menu');

        function closeAllMenus() {
            treeMenu.classList.remove('open');
            flowerMenu.classList.remove('open');
            farmerMenu.classList.remove('open');
        }

        treeBtn.addEventListener('click', (e) => {
            e.stopPropagation(); 
            const wasOpen = treeMenu.classList.contains('open');
            closeAllMenus(); 
            if (!wasOpen) treeMenu.classList.add('open');
        });

        flowerBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const wasOpen = flowerMenu.classList.contains('open');
            closeAllMenus(); 
            if (!wasOpen) flowerMenu.classList.add('open');
        });
        
        farmerBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const wasOpen = farmerMenu.classList.contains('open');
            closeAllMenus(); 
            if (!wasOpen) farmerMenu.classList.add('open');
        });

        document.body.addEventListener('click', (e) => {
            const clickInsideTree = treeMenu.contains(e.target) || treeBtn.contains(e.target);
            const clickInsideFlower = flowerMenu.contains(e.target) || flowerBtn.contains(e.target);
            const clickInsideFarmer = farmerMenu.contains(e.target) || farmerBtn.contains(e.target);
            
            if (!clickInsideTree && !clickInsideFlower && !clickInsideFarmer) {
                closeAllMenus();
            }
        });

        // --- MODAL LOGIC (Shop, Book, Self) ---
        const shopBtn = document.getElementById('btn-shop');
        const shopModal = document.getElementById('shop-modal');
        
        const bookBtn = document.getElementById('btn-book');
        const bookModal = document.getElementById('book-modal');
        const bookNavBtn = document.getElementById('book-nav-btn');
        const bookPage1 = document.getElementById('book-page-1');
        const bookPage2 = document.getElementById('book-page-2');
        let bookPage = 1;

        const selfBtn = document.getElementById('btn-self');
        const selfModal = document.getElementById('self-modal');
        
        // Summary Modal Logic
        const openSummaryBtn = document.getElementById('btn-open-summary');
        const summaryModal = document.getElementById('summary-modal');

        function closeModals() {
            shopModal.classList.remove('open');
            bookModal.classList.remove('open');
            selfModal.classList.remove('open');
            summaryModal.classList.remove('open'); // Close summary too
            
            // Reset book page on close
            setTimeout(() => {
                bookPage = 1;
                bookPage1.style.display = 'flex';
                bookPage2.style.display = 'none';
                bookNavBtn.textContent = '‚≠ê';
            }, 200);
        }

        shopBtn.addEventListener('click', (e) => {
            e.stopPropagation(); 
            const wasOpen = shopModal.classList.contains('open');
            closeModals();
            if (!wasOpen) shopModal.classList.add('open');
        });

        bookBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const wasOpen = bookModal.classList.contains('open');
            closeModals();
            if (!wasOpen) bookModal.classList.add('open');
        });
        
        // Book Page Toggle Logic
        bookNavBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (bookPage === 1) {
                bookPage = 2;
                bookPage1.style.display = 'none';
                bookPage2.style.display = 'flex';
                bookNavBtn.textContent = 'üîô';
            } else {
                bookPage = 1;
                bookPage1.style.display = 'flex';
                bookPage2.style.display = 'none';
                bookNavBtn.textContent = '‚≠ê';
            }
        });
        
        selfBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const wasOpen = selfModal.classList.contains('open');
            closeModals();
            if (!wasOpen) selfModal.classList.add('open');
        });

        // Open summary from self modal
        openSummaryBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            // Don't close self modal immediately if you want it to feel like a stack, 
            // but for simplicity we usually close others to avoid z-index mess.
            // Let's close self and open summary.
            closeModals(); 
            // Small timeout to allow transition if needed, or just open immediately
            summaryModal.classList.add('open');
        });

        document.body.addEventListener('click', (e) => {
            const clickedShop = shopModal.contains(e.target) || shopBtn.contains(e.target);
            const clickedBook = bookModal.contains(e.target) || bookBtn.contains(e.target);
            const clickedSelf = selfModal.contains(e.target) || selfBtn.contains(e.target);
            const clickedSummary = summaryModal.contains(e.target) || openSummaryBtn.contains(e.target);

            if (!clickedShop && !clickedBook && !clickedSelf && !clickedSummary) {
                closeModals();
            }
        });


        // --- DICE LOGIC ---
        const diceBtn = document.getElementById('btn-dice');
        const slots = document.querySelectorAll('.inv-slot');
        const strip = document.querySelector('.ui-inventory-strip'); 
        let isRolling = false;

        diceBtn.addEventListener('click', () => {
            if (isRolling) return; 
            isRolling = true;
            
            const targetIndex = Math.floor(Math.random() * slots.length);
            let currentIndex = 0;
            slots.forEach((slot, index) => {
                if (slot.classList.contains('active')) currentIndex = index;
            });

            // Start fast border animation
            let borderHue = 0;
            const borderInterval = setInterval(() => {
                borderHue = (borderHue + 25) % 360; 
                if (borderHue > 80 && borderHue < 170) {
                    borderHue = 170;
                }
                strip.style.borderColor = `hsl(${borderHue}, 100%, 50%)`;
            }, 30); 

            let speed = 50; 
            let steps = 0;
            const minSteps = 20;
            
            function step() {
                slots[currentIndex].classList.remove('active');
                currentIndex = (currentIndex + 1) % slots.length;
                slots[currentIndex].classList.add('active');
                steps++;
                
                // Ensure no filter is messing with numbers
                strip.style.filter = "none";

                if (steps > minSteps && currentIndex === targetIndex) {
                    isRolling = false;
                    slots[currentIndex].style.transform = "scale(1.2)";
                    
                    // --- FINISH ---
                    clearInterval(borderInterval);

                    strip.style.transition = "border-color 0.5s ease";
                    strip.style.borderColor = "rgba(255,255,255,0.3)";

                    setTimeout(() => {
                        slots[currentIndex].style.transform = "";
                        setTimeout(() => {
                            strip.style.transition = "";
                        }, 500);
                    }, 200);
                    return;
                }

                if (steps > minSteps - 8) {
                    speed += 30;
                }

                setTimeout(step, speed);
            }
            step();
        });

    </script>
</body>
</html>
