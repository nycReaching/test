<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Novel / Roguelike RPG</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500&display=swap" rel="stylesheet">
    <style>
        /* --- Theme Color Definitions --- */
        :root {
            /* Default to Day Theme */
            --background-color: #bbdefb;
            --primary-text: #0d47a1;
            --secondary-text: #1976d2;
            --card-bg: #ffffff;
            --grid-bg: #ffffff;
            --card-border: #64b5f6;
            --card-shadow: rgba(0, 0, 0, 0.15);
            --health-bar-bg: #e0e0e0;
            --health-bar-color: #f44336;
            --current-city-emoji: 'üèôÔ∏è'; /* Default emoji for day theme */
        }

        .theme-day {
            --background-color: #bbdefb;
            --primary-text: #0d47a1;
            --secondary-text: #1976d2;
            --card-bg: #ffffff;
            --grid-bg: #ffffff;
            --card-border: #64b5f6;
            --card-shadow: rgba(0, 0, 0, 0.15);
            --health-bar-bg: #e0e0e0;
            --health-bar-color: #f44336;
        }

        .theme-sunset {
            /* Updated sunset theme with dark purple and dark orange */
            --background-color: #3b1f4a; /* Dark Purple */
            --primary-text: #ffac4e;   /* Bright Orange */
            --secondary-text: #e8b7e8; /* Light Purple */
            --card-bg: #5a3d6b;       /* Lighter Purple */
            --grid-bg: #5a3d6b;
            --card-border: #c77725;   /* Dark Orange */
            --card-shadow: rgba(0, 0, 0, 0.4);
            --health-bar-bg: #6d5a91;
            --health-bar-color: #ff8c00; /* Dark Orange */
        }

        .theme-night {
            --background-color: #121212;
            --primary-text: #e0e0e0;
            --secondary-text: #a0a0a0;
            --card-bg: #1e1e1e;
            --grid-bg: #1e1e1e;
            --card-border: #333;
            --card-shadow: rgba(0, 0, 0, 0.5);
            --health-bar-bg: #424242;
            --health-bar-color: #f44336;
        }

        /* --- New Environment Themes --- */
        
        /* Pesha's Apartment Theme - Muted and soft */
        .theme-pesha {
            --background-color: #5D5C61; /* Muted grey-purple */
            --primary-text: #B7B7A4;     /* Soft beige */
            --secondary-text: #A5A58D;   /* Slightly darker beige */
            --card-bg: #737877;          /* Muted teal-grey */
            --grid-bg: #737877;
            --card-border: #939393;      /* Light grey */
            --card-shadow: rgba(0, 0, 0, 0.25);
            --health-bar-bg: #8B8B83;
            --health-bar-color: #D4D4CE;
        }

        /* Moro's Apartment Theme - Green glow */
        .theme-moro {
            --background-color: #1a2a22; /* Very dark green */
            --primary-text: #69ffb2;   /* Bright glow green */
            --secondary-text: #a0d6b4; /* Softer green */
            --card-bg: #2a4a3a;       /* Dark green */
            --grid-bg: #2a4a3a;
            --card-border: #4caf50;   /* Standard green */
            --card-shadow: rgba(76, 175, 80, 0.3);
            --health-bar-bg: #3e5e4e;
            --health-bar-color: #69ffb2;
        }

        /* Ritzi's Work Theme - Convenience Store (Pink) */
        .theme-ritzi {
            --background-color: #fce4ec; /* Light Pink */
            --primary-text: #ad1457;     /* Dark Pink */
            --secondary-text: #d81b60;   /* Medium Pink */
            --card-bg: #ffffff;          /* White */
            --grid-bg: #ffffff;
            --card-border: #f8bbd0;      /* Lighter Pink */
            --card-shadow: rgba(173, 20, 87, 0.15);
            --health-bar-bg: #fce4ec;
            --health-bar-color: #ec407a; /* Bright Pink */
        }

        /* Yoa's Fountain Plaza Theme - Lunar */
        .theme-yoa {
            --background-color: #0b192f; /* Deep space blue */
            --primary-text: #f0f8ff;   /* Alice blue (off-white) */
            --secondary-text: #b0c4de; /* Light steel blue */
            --card-bg: #1f3a5f;       /* Darker blue */
            --grid-bg: #1f3a5f;
            --card-border: #7b94b8;   /* Muted blue-grey */
            --card-shadow: rgba(255, 255, 255, 0.1);
            --health-bar-bg: #4a6a8a;
            --health-bar-color: #FFC107; /* Moon yellow */
        }

        /* Train Theme */
        .theme-train {
            --background-color: #616161; /* Medium Grey */
            --primary-text: #ffeb3b;   /* Yellow */
            --secondary-text: #e0e0e0; /* Light Grey */
            --card-bg: #424242;       /* Dark Grey */
            --grid-bg: #424242;
            --card-border: #757575;   /* Grey */
            --card-shadow: rgba(0, 0, 0, 0.4);
            --health-bar-bg: #555;
            --health-bar-color: #ffeb3b;
        }

        /* Hospital Theme */
        .theme-hospital {
            --background-color: #e3f2fd; /* Very Light Blue */
            --primary-text: #01579b;   /* Dark Blue */
            --secondary-text: #29b6f6; /* Light Blue */
            --card-bg: #ffffff;       /* White */
            --grid-bg: #ffffff;
            --card-border: #81d4fa;   /* Lighter Blue */
            --card-shadow: rgba(0, 0, 0, 0.1);
            --health-bar-bg: #e0e0e0;
            --health-bar-color: #ef5350; /* Red */
        }

        /* Old Factory Theme */
        .theme-factory {
            --background-color: #3e2723; /* Dark Brown */
            --primary-text: #ffab40;   /* Orange Accent */
            --secondary-text: #a1887f; /* Brown-Grey */
            --card-bg: #4e342e;       /* Darker Brown */
            --grid-bg: #4e342e;
            --card-border: #bf360c;   /* Deep Orange (Rust) */
            --card-shadow: rgba(0, 0, 0, 0.5);
            --health-bar-bg: #6d4c41;
            --health-bar-color: #ffab40;
        }

        /* Corporate Offices Theme */
        .theme-corporate {
            --background-color: #263238; /* Blue Grey */
            --primary-text: #eceff1;   /* Light Grey */
            --secondary-text: #90a4ae; /* Grey */
            --card-bg: #37474f;       /* Darker Blue Grey */
            --grid-bg: #37474f;
            --card-border: #546e7a;   /* Grey */
            --card-shadow: rgba(0, 0, 0, 0.3);
            --health-bar-bg: #455a64;
            --health-bar-color: #40c4ff; /* Light Blue Accent */
        }

        /* --- Basic Setup --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--primary-text);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* --- Main Game Container --- */
        #game-container {
            width: 100%;
            max-width: 1400px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- Home Grid Area --- */
        #home-grid-area {
            flex-grow: 1;
            background-color: var(--grid-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            margin-bottom: 20px;
            padding: 20px;
            display: grid;
            /* Changed to 2 columns */
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            box-shadow: 0 4px 15px var(--card-shadow);
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        
        .grid-item {
            background-color: var(--background-color);
            border-radius: 8px;
            border: 1px solid var(--card-border);
            min-height: 100px;
            transition: background-color 0.5s ease, border-color 0.5s ease;
            position: relative; /* Needed for absolute positioning of children */
            overflow: hidden; /* Hide overflowing animation emojis */
            z-index: 1; /* Ensure grid items are above the background emoji */
        }

        /* Style for the video container to make the iframe responsive */
        #video-container {
            padding: 0; /* Remove padding for the video container */
        }

        #video-container iframe {
            width: 100%;
            height: 100%;
            border: 0;
            border-radius: 8px; /* Match parent's border radius */
        }

        /* Background city emoji for the crowd container */
        #crowd-container::after {
            content: var(--current-city-emoji);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12rem;
            opacity: 0.1;
            z-index: 0;
            pointer-events: none; /* Make sure it doesn't interfere with clicks */
        }
        
        /* Styles for the floating crowd icons */
        .crowd-icon {
            position: absolute;
            font-size: 1.8rem;
            user-select: none; /* Prevent text selection */
            opacity: 0.7;
        }


        /* --- Events Row --- */
        #events-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: var(--grid-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--card-shadow);
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }

        .event-emoji {
            font-size: 2.5rem;
            cursor: pointer;
            transition: transform 0.2s ease, filter 0.3s ease;
        }

        .event-emoji:hover {
            transform: scale(1.2);
        }

        .event-emoji.locked {
            filter: grayscale(100%) opacity(0.5);
            cursor: not-allowed;
        }
        
        .event-emoji.locked:hover {
            transform: none;
        }

        /* --- Character Cards Area --- */
        #character-cards-area {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        
        /* --- Card Flip Mechanics --- */
        .character-card {
            background-color: transparent;
            aspect-ratio: 1 / 1.2; /* Adjusted ratio for more space */
            perspective: 1000px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s, box-shadow 0.3s ease;
            transform-style: preserve-3d;
            box-shadow: 0 4px 15px var(--card-shadow);
            border-radius: 12px;
        }
        
        .character-card:hover .card-inner {
             box-shadow: 0 8px 25px var(--card-shadow);
        }

        .card-inner.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        
        .card-back {
            transform: rotateY(180deg);
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--secondary-text);
        }

        /* --- Card Content Styling --- */
        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .card-header .emoji {
            font-size: 2rem;
        }

        .card-description {
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--secondary-text);
            flex-grow: 1;
            margin: 10px 0;
            transition: color 0.5s ease;
        }

        .card-description .highlight {
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
        }
        
        .card-description .green { color: #4caf50; }
        .card-description .black { color: #212121; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6), 0 0 5px #fff; }
        .card-description .phone { color: #9c27b0; }
        .card-description .moon { color: #FFC107; }

        /* --- Character Actions --- */
        .action-area {
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid var(--card-border);
            border-radius: 8px;
            min-height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap; /* Allow items to wrap */
        }
        
        /* Moro's Slot Machine */
        .slot-reel {
            font-size: 1.8rem;
            background: var(--background-color);
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid var(--card-border);
        }
        .spin-button {
            font-size: 1.8rem; /* Increased size */
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s;
        }
        .spin-button:active {
            transform: scale(0.9);
        }

        /* Pesha's Slider */
        .action-slider {
            width: 80%;
            cursor: pointer;
        }

        /* Ritzi's Dice */
        .die {
            font-size: 2rem;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s ease;
        }
        .die:hover {
            transform: rotate(15deg) scale(1.1);
        }


        /* --- Unique Items --- */
        .unique-items {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        .item-slot {
            flex: 1;
            height: 35px;
            background-color: var(--background-color);
            border: 1px dashed var(--card-border);
            border-radius: 6px;
            transition: background-color 0.5s ease, border-color 0.5s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
        }

        /* --- Stats --- */
        .health-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .health-bar-container {
            background-color: var(--health-bar-bg);
            border-radius: 5px;
            height: 10px;
            flex-grow: 1;
            overflow: hidden;
            border: 1px solid var(--card-border);
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        
        .health-bar {
            background-color: var(--health-bar-color);
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease-in-out, background-color 0.5s ease;
        }

        .card-stats {
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid var(--card-border);
            padding-top: 10px;
            transition: border-color 0.5s ease;
        }

        .stat {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .money-box {
            background-color: #006400; /* Dark Green */
            color: #ffffff;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .stat-depth {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .stat-hope {
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            font-weight: 700;
        }
    </style>
</head>
<body class="theme-day"> 
    <div id="game-container">

        <div id="home-grid-area">
            <div id="crowd-container" class="grid-item"></div>
            <div id="video-container" class="grid-item">
                <iframe width="560" height="315" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
            </div>
        </div>

        <div id="events-row">
            <div class="event-emoji" id="theme-day-btn" title="City (day)">üèôÔ∏è</div>
            <div class="event-emoji" id="theme-sunset-btn" title="City (sunset)">üåá</div>
            <div class="event-emoji" id="theme-night-btn" title="City (night)">üåÉ</div>
            <div class="event-emoji" id="theme-pesha-btn" title="Pesha‚Äôs Apartment">üõãÔ∏è</div>
            <div class="event-emoji" id="theme-moro-btn" title="Moro‚Äôs Apartment">ü™ë</div>
            <div class="event-emoji" id="theme-ritzi-btn" title="Ritzi‚Äôs Work">üè™</div>
            <div class="event-emoji" id="theme-yoa-btn" title="Fountain Plaza (Yoa)">‚õ≤</div>
            <div class="event-emoji" id="theme-train-btn" title="Train (riding)">üöÜ</div>
            <div class="event-emoji" id="theme-hospital-btn" title="Hospital">üè•</div>
            <div class="event-emoji" id="theme-factory-btn" title="Old Factory">üè≠</div>
            <div class="event-emoji" id="theme-corporate-btn" title="Corporate Offices">üè¢</div>
        </div>

        <div id="character-cards-area">
            <div class="character-card" data-character="moro">
                <div class="card-inner">
                    <div class="card-front">
                        <div class="card-header"><span class="emoji">üë®üèº‚Äçü¶±</span><span>Moro</span></div>
                        <p class="card-description"><span class="highlight green">üü¢ Moro‚Äôs head disappears into a field of green light,</span> shifting his awareness away from his mind and into the glow.</p>
                        <div class="action-area" id="moro-action">
                            <div class="slot-reel">‚ùå</div>
                            <div class="slot-reel">‚≠ï</div>
                            <div class="slot-reel">‚ùå</div>
                            <div class="spin-button" title="Spin">üü¢</div>
                        </div>
                        <div class="unique-items">
                            <div class="item-slot"></div>
                            <div class="item-slot"></div>
                            <div class="item-slot"></div>
                        </div>
                        <div class="health-stat"><span class="stat">(35/35)</span><div class="health-bar-container"><div class="health-bar" style="width: 100%;"></div></div></div>
                        <div class="card-stats">
                            <div class="stat"><span class="money-box">$20</span></div>
                            <div class="stat stat-depth">Depth: 3</div>
                            <div class="stat stat-hope">Hope: 4</div>
                        </div>
                    </div>
                    <div class="card-back">More Info</div>
                </div>
            </div>

            <div class="character-card" data-character="pesha">
                <div class="card-inner">
                    <div class="card-front">
                        <div class="card-header"><span class="emoji">üë©üèª‚Äçü¶±</span><span>Pesha</span></div>
                        <p class="card-description"><span class="highlight black">‚¨õ Pesha is very hard to notice,</span> it‚Äôs something like a curse.</p>
                        <div class="action-area" id="pesha-action">
                           <input type="range" min="1" max="100" value="50" class="action-slider">
                        </div>
                        <div class="unique-items">
                            <div class="item-slot"></div>
                            <div class="item-slot"></div>
                            <div class="item-slot"></div>
                        </div>
                        <div class="health-stat"><span class="stat">(42/42)</span><div class="health-bar-container"><div class="health-bar" style="width: 100%;"></div></div></div>
                        <div class="card-stats">
                            <div class="stat"><span class="money-box">$35</span></div>
                            <div class="stat stat-depth">Depth: 5</div>
                            <div class="stat stat-hope">Hope: 4</div>
                        </div>
                    </div>
                    <div class="card-back">More Info</div>
                </div>
            </div>

            <div class="character-card" data-character="ritzi">
                <div class="card-inner">
                    <div class="card-front">
                        <div class="card-header"><span class="emoji">üë©üèª‚Äçü¶∞</span><span>Ritzi</span></div>
                        <p class="card-description"><span class="highlight phone">üì± Ritzi must stay on the phone with her ‚Äútwin‚Äù or she‚Äôll die,</span> but two minds are better than one.</p>
                        <div class="action-area" id="ritzi-action">
                            <div class="die">üé≤</div>
                            <div class="die">üé≤</div>
                            <div class="die">üé≤</div>
                            <div class="die">üé≤</div>
                            <div class="die">üé≤</div>
                        </div>
                        <div class="unique-items"><div class="item-slot"></div><div class="item-slot"></div><div class="item-slot"></div></div>
                        <div class="health-stat"><span class="stat">(40/40)</span><div class="health-bar-container"><div class="health-bar" style="width: 100%;"></div></div></div>
                        <div class="card-stats">
                            <div class="stat"><span class="money-box">$75</span></div>
                            <div class="stat stat-depth">Depth: 3</div>
                            <div class="stat stat-hope">Hope: 10</div>
                        </div>
                    </div>
                    <div class="card-back">More Info</div>
                </div>
            </div>

            <div class="character-card" data-character="yoa">
                <div class="card-inner">
                    <div class="card-front">
                        <div class="card-header"><span class="emoji">üßëüèΩ‚Äçü¶∞</span><span>Yoa</span></div>
                        <p class="card-description"><span class="highlight moon">  Yoa‚Äôs only threat is having the moon slowly crush someone,</span> but only from their perspective.</p>
                        <div class="action-area"></div>
                        <div class="unique-items"><div class="item-slot"></div><div class="item-slot"></div><div class="item-slot"></div></div>
                        <div class="health-stat"><span class="stat">(17/17)</span><div class="health-bar-container"><div class="health-bar" style="width: 100%;"></div></div></div>
                        <div class="card-stats">
                            <div class="stat"><span class="money-box">$0</span></div>
                            <div class="stat stat-depth">Depth: ‚õ¨</div>
                            <div class="stat stat-hope">‚õö</div>
                        </div>
                    </div>
                    <div class="card-back">More Info</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const root = document.documentElement;
            
            // --- Card Flip Functionality ---
            const cards = document.querySelectorAll('.character-card');
            cards.forEach(card => {
                card.addEventListener('click', (e) => {
                    // Prevent card flip if an action element was clicked
                    if (e.target.closest('.action-area')) {
                        return;
                    }
                    card.querySelector('.card-inner').classList.toggle('flipped');
                });
            });

            // --- Theme & Video Switching Functionality ---
            const body = document.body;
            const crowdContainer = document.getElementById('crowd-container');
            const videoFrame = document.querySelector('#video-container iframe');

            const themeVideos = {
                'theme-day': '4',
                'theme-sunset': '5',
                'theme-night': '6',
                'theme-pesha': '7',
                'theme-moro': '8',
                'theme-ritzi': '9',
                'theme-yoa': '10',
                'theme-train': '11',
                'theme-hospital': '12',
                'theme-factory': '13',
                'theme-corporate': '14'
            };

            // Event Buttons
            const dayBtn = document.getElementById('theme-day-btn');
            const sunsetBtn = document.getElementById('theme-sunset-btn');
            const nightBtn = document.getElementById('theme-night-btn');
            const peshaBtn = document.getElementById('theme-pesha-btn');
            const moroBtn = document.getElementById('theme-moro-btn');
            const ritziBtn = document.getElementById('theme-ritzi-btn');
            const yoaBtn = document.getElementById('theme-yoa-btn');
            const trainBtn = document.getElementById('theme-train-btn');
            const hospitalBtn = document.getElementById('theme-hospital-btn');
            const factoryBtn = document.getElementById('theme-factory-btn');
            const corporateBtn = document.getElementById('theme-corporate-btn');

            const clearCrowd = () => {
                // Stop any animation frame requests
                if (window.crowdAnimationId) {
                    cancelAnimationFrame(window.crowdAnimationId);
                    window.crowdAnimationId = null;
                }
                // Remove existing crowd icons
                if (crowdContainer) {
                    const existingIcons = crowdContainer.querySelectorAll('.crowd-icon');
                    existingIcons.forEach(icon => icon.remove());
                }
            };

            const setTheme = (themeName, emoji) => {
                body.className = ''; // Clear all classes
                body.classList.add(themeName);
                
                // Update the background emoji
                root.style.setProperty('--current-city-emoji', `'${emoji}'`);

                // Update the video
                const videoId = themeVideos[themeName];
                if (videoId && videoFrame) {
                    // Parameters: autoplay, mute (required for autoplay), loop, playlist (required for loop), no controls for clean look
                    videoFrame.src = `https://www.youtube.com/watch?v=...8`;
                }

                // Clear existing crowd before deciding to animate or not
                clearCrowd();

                // Only run crowd animation for city themes
                if (['theme-day', 'theme-sunset', 'theme-night'].includes(themeName)) {
                    animateCrowd();
                }
            };

            dayBtn.addEventListener('click', () => setTheme('theme-day', 'üèôÔ∏è'));
            sunsetBtn.addEventListener('click', () => setTheme('theme-sunset', 'üåá'));
            nightBtn.addEventListener('click', () => setTheme('theme-night', 'üåÉ'));
            peshaBtn.addEventListener('click', () => setTheme('theme-pesha', 'üõãÔ∏è'));
            moroBtn.addEventListener('click', () => setTheme('theme-moro', 'ü™ë'));
            ritziBtn.addEventListener('click', () => setTheme('theme-ritzi', 'üè™'));
            yoaBtn.addEventListener('click', () => setTheme('theme-yoa', '‚õ≤'));
            trainBtn.addEventListener('click', () => setTheme('theme-train', 'üöÜ'));
            hospitalBtn.addEventListener('click', () => setTheme('theme-hospital', 'üè•'));
            factoryBtn.addEventListener('click', () => setTheme('theme-factory', 'üè≠'));
            corporateBtn.addEventListener('click', () => setTheme('theme-corporate', 'üè¢'));
            
            // --- Crowd Animation ---
            function animateCrowd() {
                const container = document.getElementById('crowd-container');
                if (!container) return;

                const icons = ['üó£Ô∏è', 'üë§', 'üë•'];
                const crowd = [];
                const iconCount = 4;

                // Create icons
                icons.forEach(icon => {
                    for (let i = 0; i < iconCount; i++) {
                        const el = document.createElement('div');
                        el.classList.add('crowd-icon');
                        el.textContent = icon;
                        container.appendChild(el);

                        crowd.push({
                            el: el,
                            x: Math.random() * container.clientWidth,
                            y: Math.random() * container.clientHeight,
                            vx: (Math.random() - 0.5) * 2, // -1 to 1
                            vy: (Math.random() - 0.5) * 2, // -1 to 1
                        });
                    }
                });

                function update() {
                    if (!container) return;
                    const { clientWidth, clientHeight } = container;

                    crowd.forEach(p => {
                        // Move particle
                        p.x += p.vx;
                        p.y += p.vy;

                        // Bounce off edges and clamp position to prevent glitches
                        if (p.x <= 0) {
                            p.vx *= -1;
                            p.x = 0;
                        } else if (p.x + p.el.clientWidth >= clientWidth) {
                            p.vx *= -1;
                            p.x = clientWidth - p.el.clientWidth;
                        }

                        if (p.y <= 0) {
                            p.vy *= -1;
                            p.y = 0;
                        } else if (p.y + p.el.clientHeight >= clientHeight) {
                            p.vy *= -1;
                            p.y = clientHeight - p.el.clientHeight;
                        }
                        
                        // Apply position
                        p.el.style.transform = `translate(${p.x}px, ${p.y}px)`;
                    });

                    window.crowdAnimationId = requestAnimationFrame(update);
                }
                update();
            }

            // --- Character Action Mechanics ---
            
            // Moro's Slot Machine
            const moroAction = document.getElementById('moro-action');
            if (moroAction) {
                const reels = moroAction.querySelectorAll('.slot-reel');
                const spinButton = moroAction.querySelector('.spin-button');
                const symbols = ['‚ùå', '‚≠ï'];

                spinButton.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent card from flipping
                    reels.forEach(reel => {
                        const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                        reel.textContent = randomSymbol;
                    });
                });
            }

            // Pesha's Slider
            const peshaAction = document.getElementById('pesha-action');
            if(peshaAction) {
                peshaAction.addEventListener('click', e => e.stopPropagation());
            }

            // Ritzi's Dice
            const ritziAction = document.getElementById('ritzi-action');
            if (ritziAction) {
                const dice = ritziAction.querySelectorAll('.die');
                const dieFaces = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];

                dice.forEach(die => {
                    die.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent card from flipping
                        const randomFace = dieFaces[Math.floor(Math.random() * dieFaces.length)];
                        die.textContent = randomFace;
                    });
                });
            }

            // Set the initial theme and video on page load
            setTheme('theme-day', 'üèôÔ∏è');
        });
    </script>

</body>
</html>
