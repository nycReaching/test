<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Slot Game ‚Äî Upgrades + Onboarding (Visual Upgrade)</title>
  <style>
    /* =========================
       BASE VARIABLES
       (logic-friendly, just visuals)
       ========================= */
    :root{
      --bg:#02030a;
      --panel:#060815;
      --panel-2:#050712;
      --text:#f7fbff;
      --muted:#9eb0c3;
      --track:#111827;
      --track-h:14px;
      --thumb-size:28px;
      --brd:#26364a;
      --brd-strong:#4aa8ff;
      --brd-width:2px;
      --shadow-1:0 6px 18px rgba(0,0,0,.55);
      --shadow-2:0 28px 60px rgba(0,0,0,.85);

      --money-bg: radial-gradient(circle at 0% 0%, #245f3f 0, #06130c 55%, #02050a 100%);
      --money-brd: oklch(60% .14 150);
      --credit-bg: radial-gradient(circle at 100% 0%, #4a1f69 0, #090215 55%, #02020a 100%);
      --credit-brd: oklch(60% .16 315);
      --rate1-bg: radial-gradient(circle at 0% 100%, #3b1d66 0, #050513 55%, #02030a 100%);
      --rate1-accent: oklch(86% .18 28);
      --rate2-bg: radial-gradient(circle at 100% 100%, #005b7d 0, #021018 55%, #01020a 100%);
      --rate2-accent: oklch(88% .13 180);
      --money-text: oklch(93% .16 120);
      --credit-text: oklch(93% .12 330);

      --tap:48px;
      --neon-main: #4aa8ff;
      --neon-alt: #f97316;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
      color:var(--text);
      background:
        radial-gradient(circle at top, rgba(75,0,130,.4) 0, transparent 60%),
        radial-gradient(circle at 15% 80%, rgba(0,188,212,.35) 0, transparent 55%),
        radial-gradient(circle at 80% 20%, rgba(249,115,22,.3) 0, transparent 55%),
        #02030a;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    /* Faint scanline / grid vibe */
    body::before{
      content:"";
      position:fixed;
      inset:-40px;
      pointer-events:none;
      background-image:
        linear-gradient(rgba(255,255,255,.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.04) 1px, transparent 1px);
      background-size:0 0, 120px 120px;
      opacity:.4;
      mix-blend-mode:soft-light;
      z-index:0;
    }

    .wrap{
      width:min(980px,96vw);
      position:relative;
      z-index:1;
    }

    .card{
      position:relative;
      background: radial-gradient(circle at 20% -10%, rgba(74,168,255,.5) 0, transparent 55%),
                  radial-gradient(circle at 80% 110%, rgba(249,115,22,.45) 0, transparent 55%),
                  radial-gradient(circle at 50% 50%, #050713 0, #02030a 65%, #000 100%);
      border-radius:24px;
      padding:22px clamp(16px,4vw,32px) 20px;
      box-shadow: var(--shadow-2), 0 0 40px rgba(74,168,255,.35);
      border:1px solid rgba(255,255,255,.1);
      outline:1px solid rgba(0,0,0,.7);
      overflow:clip;
      backdrop-filter:blur(14px) saturate(140%);
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      background:conic-gradient(from 180deg,rgba(74,168,255,.35),rgba(249,115,22,.25),rgba(74,222,128,.32),rgba(74,168,255,.35));
      mix-blend-mode:soft-light;
      opacity:.55;
      pointer-events:none;
    }

    .card::after{
      content:"ECONOMY SLOT";
      position:absolute;
      top:12px;
      left:18px;
      font-size:10px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color:rgba(226,232,240,.72);
      text-shadow:0 0 12px rgba(15,118,255,.8);
    }

    /* HEADER */
    #gameTimer{
      text-align:center;
      font-size:18px;
      font-weight:800;
      letter-spacing:.32em;
      margin:0 auto 10px auto;
      padding:10px 20px;
      border-radius:999px;
      background: radial-gradient(circle at 50% 0, rgba(74,168,255,.8) 0, rgba(15,23,42,1) 45%, rgba(2,6,23,1) 100%);
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 0 18px rgba(74,168,255,.75);
      text-shadow:0 0 14px rgba(15,23,42,.9);
      min-width:210px;
    }

    .goal-text{
      font-size:13px;
      color:rgba(203,213,225,.9);
      text-align:center;
      margin-bottom:16px;
      max-width:560px;
      margin-left:auto;
      margin-right:auto;
    }

    .goal-text strong{
      color:var(--money-text);
      text-shadow:0 0 10px rgba(34,197,94,.7);
    }

    /* STATS ROW */
    .stats-grid{
      display:grid;
      grid-template-columns:repeat(4,minmax(0,1fr));
      gap:12px clamp(10px,2.5vw,18px);
      margin-bottom:16px;
    }

    .stat{
      position:relative;
      border-radius:18px;
      padding:12px 14px 12px 14px;
      overflow:hidden;
      border:1px solid rgba(148,163,184,.28);
      background:radial-gradient(circle at 0 0,rgba(148,163,184,.25) 0,transparent 45%),
                 linear-gradient(135deg,rgba(15,23,42,.92),rgba(15,23,42,.98));
      box-shadow:var(--shadow-1);
      isolation:isolate;
    }

    .stat::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 0 0,rgba(255,255,255,.12) 0,transparent 60%);
      opacity:.5;
      mix-blend-mode:soft-light;
      pointer-events:none;
      z-index:-1;
    }

    .label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:rgba(148,163,184,.9);
    }

    .value{
      font-size:clamp(20px,4.4vw,30px);
      font-weight:900;
      margin-top:6px;
      line-height:1.05;
      text-shadow:0 0 10px rgba(0,0,0,.9);
    }

    .growth{margin-top:6px;font-size:11px;color:rgba(148,163,184,.9)}

    .stat.money{
      background:var(--money-bg);
      border-color:var(--money-brd);
      box-shadow:0 0 24px rgba(34,197,94,.5);
    }

    .stat.money .label{color:rgba(226,232,240,.96);}
    .stat.money .value{color:var(--money-text);}

    .stat.credit{
      background:var(--credit-bg);
      border-color:var(--credit-brd);
      box-shadow:0 0 24px rgba(168,85,247,.55);
    }

    .stat.credit .label{color:rgba(244,244,255,.95);}
    .stat.credit .value{color:var(--credit-text);}

    .stat.rate1{
      background:var(--rate1-bg);
      border-color:rgba(249,115,22,.75);
    }

    .stat.rate1 .label,.stat.rate1 .value,.stat.rate1 .growth{color:var(--rate1-accent);}

    .stat.rate2{
      background:var(--rate2-bg);
      border-color:rgba(56,189,248,.9);
    }

    .stat.rate2 .label,.stat.rate2 .value,.stat.rate2 .growth{color:var(--rate2-accent);}

    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:2px 10px;
      border-radius:999px;
      font-size:11px;
      font-weight:800;
      letter-spacing:.04em;
      text-transform:uppercase;
      background:#111827;
      color:#e5f0ff;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 0 14px rgba(15,23,42,.85);
      vertical-align:middle;
      gap:4px;
    }

    .badge::before{
      content:"";
      width:6px;
      height:6px;
      border-radius:50%;
      background:radial-gradient(circle,#facc15 0,#f97316 50%,rgba(0,0,0,0) 100%);
      box-shadow:0 0 10px rgba(248,250,252,.75);
    }

    .badge.badge-rate1{
      background:rgba(30,64,175,.32);
      color:var(--rate1-accent);
      border-color:rgba(249,115,22,.8);
    }

    .badge.badge-rate2{
      background:rgba(8,47,73,.46);
      color:var(--rate2-accent);
      border-color:rgba(56,189,248,.8);
    }

    .badge.badge-money{
      background:rgba(22,101,52,.7);
      color:var(--money-text);
      border-color:var(--money-brd);
    }

    .badge.badge-credit{
      background:rgba(76,29,149,.7);
      color:var(--credit-text);
      border-color:var(--credit-brd);
    }

    /* SLIDER */
    .slider-wrap{margin-top:4px;display:flex;justify-content:center;}

    .slider{
      position:relative;
      height:80px;
      user-select:none;
      width:min(520px,100%);
      margin:0 auto;
      padding:0 24px;
    }

    .track{
      position:absolute;
      left:24px;
      right:24px;
      top:50%;
      transform:translateY(-50%);
      height:var(--track-h);
      border-radius:999px;
      background:linear-gradient(90deg,#0f172a 0%,#1d4ed8 30%,#22c55e 70%,#0f172a 100%);
      box-shadow:0 0 16px rgba(59,130,246,.65),inset 0 0 0 1px rgba(15,23,42,1);
      overflow:hidden;
    }

    .track::before{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(120deg,rgba(255,255,255,.4) 0,transparent 40%,transparent 60%,rgba(255,255,255,.3) 100%);
      mix-blend-mode:soft-light;
      opacity:.7;
    }

    .ticks{position:absolute;left:24px;right:24px;font-size:11px;font-weight:800;text-shadow:0 0 8px rgba(15,23,42,1);}
    .ticks-top{top:2px;color:var(--rate2-accent);}
    .ticks-bottom{bottom:2px;color:var(--rate1-accent);}

    .ticks span{opacity:.9;}

    .thumb{
      position:absolute;
      top:50%;
      transform:translate(-50%,-50%);
      width:var(--thumb-size);
      height:var(--thumb-size);
      border-radius:12px;
      cursor:grab;
      background:radial-gradient(circle at 30% 0,#e5e7eb 0,#9ca3af 40%,#020617 100%);
      border:1px solid rgba(15,23,42,1);
      box-shadow:0 0 0 1px rgba(148,163,184,.8),0 0 26px rgba(74,168,255,.9);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .thumb::after{
      content:"";
      width:14px;
      height:3px;
      border-radius:999px;
      background:linear-gradient(90deg,#0f172a,#e5e7eb,#0f172a);
      box-shadow:0 0 8px rgba(15,23,42,1);
    }

    .helper-text{
      font-size:12px;
      color:rgba(148,163,184,.96);
      text-align:center;
      margin-top:10px;
    }

    .helper-text.helper-slot{margin-top:4px;}

    /* CONTROLS STRIP */
    .controls{
      margin-top:16px;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }

    button.ctrl{
      position:relative;
      background:radial-gradient(circle at 0 0,#1d4ed8 0,transparent 55%),
                 radial-gradient(circle at 100% 100%,#f97316 0,transparent 55%),
                 #020617;
      color:var(--text);
      border:1px solid rgba(148,163,184,.55);
      border-radius:999px;
      padding:10px 16px;
      font-weight:800;
      font-size:13px;
      letter-spacing:.08em;
      text-transform:uppercase;
      cursor:pointer;
      min-height:var(--tap);
      box-shadow:0 14px 26px rgba(15,23,42,.9),0 0 20px rgba(15,23,42,.85);
      text-shadow:0 0 10px rgba(15,23,42,1);
      transition:transform .08s ease-out,box-shadow .08s ease-out,background .12s ease-out,filter .08s;
    }

    button.ctrl::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      border:1px solid rgba(255,255,255,.16);
      opacity:.7;
      pointer-events:none;
    }

    button.ctrl:active{
      transform:translateY(1px) scale(.98);
      box-shadow:0 6px 10px rgba(15,23,42,.9);
      filter:brightness(.95);
    }

    .ctrl-fixed{width:108px;padding-inline:12px;font-size:11px;}

    #swapBtn{
      background:linear-gradient(90deg,#22c55e 0,#22c55e 48%,#eab308 52%,#eab308 100%);
      border-color:rgba(250,204,21,.85);
    }

    #swapBtn:disabled{opacity:.3;cursor:not-allowed;filter:grayscale(1);}    

    #pause{
      background:radial-gradient(circle at 0 0,#f97316 0,transparent 40%),
                 radial-gradient(circle at 100% 100%,#dc2626 0,transparent 40%),
                 #020617;
    }

    #upgradeBtn{
      background:radial-gradient(circle at 0 0,#a855f7 0,transparent 50%),
                 radial-gradient(circle at 100% 100%,#0ea5e9 0,transparent 60%),
                 #020617;
      border-color:rgba(192,132,252,.8);
      color:#f9fafb;
    }

    #upgradeBtn:disabled,
    #pause:disabled,
    #buyBtn:disabled{
      opacity:.4;
      cursor:not-allowed;
      filter:grayscale(1);
    }

    button.ctrl-buy{
      background:radial-gradient(circle at 0 0,#a855f7 0,transparent 45%),
                 radial-gradient(circle at 100% 100%,#0ea5e9 0,transparent 55%),
                 #020617;
      border-color:var(--credit-brd);
      color:var(--text);
      padding:14px 20px;
      font-size:15px;
    }

    #spin.ctrl{
      background:radial-gradient(circle at 0 0,#22c55e 0,transparent 45%),
                 radial-gradient(circle at 100% 100%,#eab308 0,transparent 55%),
                 #020617;
      border-color:var(--money-brd);
      padding:14px 20px;
      font-size:15px;
    }

    /* SLOT AREA */
    .slot{
      margin-top:20px;
      padding-top:18px;
      border-top:1px solid rgba(31,41,55,.9);
      position:relative;
    }

    .slot::before{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 50% -40%,rgba(250,204,21,.22) 0,transparent 60%);
      opacity:.9;
      pointer-events:none;
      mix-blend-mode:screen;
    }

    .slot h2{
      margin:0 0 2px 0;
      font-size:clamp(16px,2.6vw,22px);
      font-weight:900;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#e5e7eb;
      text-align:center;
      text-shadow:0 0 18px rgba(0,0,0,.9);
    }

    .reels{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:14px;
      margin:12px 0 8px;
    }

    .reel{
      position:relative;
      background:radial-gradient(circle at 50% 0,#1e293b 0,#020617 65%,#000 100%);
      border-radius:20px;
      height:112px;
      display:grid;
      place-items:center;
      font-size:clamp(40px,6vw,64px);
      border:1px solid rgba(148,163,184,.8);
      box-shadow:0 18px 30px rgba(15,23,42,.95),0 0 30px rgba(0,0,0,.85);
      overflow:hidden;
    }

    .reel::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:linear-gradient(180deg,rgba(255,255,255,.12) 0,transparent 40%,transparent 60%,rgba(15,23,42,.9) 100%);
      mix-blend-mode:soft-light;
      opacity:.9;
      pointer-events:none;
    }

    .reel-win{
      animation:winPulse .5s 2;
      border-color:#facc15 !important;
      box-shadow:0 0 32px rgba(252,211,77,.9),0 18px 30px rgba(15,23,42,.95);
    }

    .slot-actions{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:18px;
      margin-top:12px;
    }

    .action{display:flex;flex-direction:column;}
    .action .ctrl{width:100%;}

    .cost,.buy-cost-text{
      font-size:11px;
      color:#e5e7eb;
      text-align:center;
      margin-top:8px;
      line-height:1.4;
    }

    /* SUMMARY PANEL */
    .summary{
      margin-top:20px;
      padding-top:14px;
      border-top:1px dashed rgba(31,41,55,.9);
      font-size:13px;
      color:var(--muted);
    }

    .summary h2{
      font-size:15px;
      margin:0 0 6px 0;
      text-align:center;
      text-transform:uppercase;
      letter-spacing:.2em;
      color:#e5e7eb;
    }

    .summary-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:6px 18px;
    }

    .summary-label{color:rgba(148,163,184,.95);}
    .summary-value{color:#f9fafb;font-weight:600;}

    /* MODALS */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:radial-gradient(circle at 20% 0,rgba(30,64,175,.6) 0,transparent 55%),
                 radial-gradient(circle at 80% 100%,rgba(220,38,38,.5) 0,transparent 55%),
                 rgba(3,7,18,.9);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:1001;
      backdrop-filter:blur(18px);
    }

    .modal{
      background:radial-gradient(circle at 0 0,rgba(148,163,184,.2) 0,transparent 55%),
                 #020617;
      border-radius:20px;
      width:min(440px,92vw);
      padding:20px 18px 18px;
      box-shadow:0 30px 80px rgba(0,0,0,.95);
      border:1px solid rgba(148,163,184,.8);
      position:relative;
      overflow:hidden;
    }

    .modal::before{
      content:"";
      position:absolute;
      inset:-30%;
      background:radial-gradient(circle at 0 0,rgba(74,168,255,.28) 0,transparent 55%);
      opacity:.9;
      mix-blend-mode:screen;
      pointer-events:none;
    }

    .modal h3{
      margin:0 0 8px 0;
      font-size:20px;
      text-align:center;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:#e5e7eb;
    }

    .modal p{
      margin:0 0 12px 0;
      color:rgba(203,213,225,.96);
      font-size:14px;
      text-align:center;
    }

    .modal .actions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    .btn{
      appearance:none;
      border-radius:999px;
      padding:13px 16px;
      font-weight:900;
      font-size:14px;
      cursor:pointer;
      min-height:48px;
      border:1px solid transparent;
      text-transform:uppercase;
      letter-spacing:.12em;
      box-shadow:0 14px 28px rgba(15,23,42,.9);
      transition:transform .08s ease-out,box-shadow .08s ease-out,filter .08s;
    }

    .btn.primary{
      background:linear-gradient(135deg,#22c55e,#a3e635);
      border-color:rgba(190,242,100,.95);
      color:#022c22;
    }

    .btn.secondary{
      background:radial-gradient(circle at 0 0,rgba(148,163,184,.3) 0,transparent 55%),
                 #020617;
      border-color:rgba(148,163,184,.9);
      color:#e5e7eb;
    }

    .btn:active{
      transform:translateY(1px) scale(.98);
      box-shadow:0 8px 18px rgba(15,23,42,.9);
      filter:brightness(.95);
    }

    .modal .upgrade-option p{
      margin:0 0 10px 0;
      color:#e5e7eb;
      font-size:14px;
      line-height:1.4;
      text-align:center;
    }

    .modal .upgrade-option p small{
      color:var(--muted);
      font-size:11px;
    }

    .modal .upgrade-option .btn{width:100%;}

    #confettiCanvas{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:1000;
      display:none;
    }

    @keyframes winPulse {
      0%,100%{transform:scale(1);}
      50%{transform:scale(1.05);}
    }

    /* RESPONSIVE */
    @media (max-width:780px){
      .wrap{width:100vw;padding-inline:10px;}
      .card{border-radius:0;padding:max(14px,env(safe-area-inset-top)) max(14px,env(safe-area-inset-right)) max(14px,env(safe-area-inset-bottom)) max(14px,env(safe-area-inset-left));}
      .stats-grid{grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-bottom:12px;}
      .stat{padding:10px 12px;border-radius:16px;}
      .value{font-size:clamp(20px,6.5vw,28px);margin-top:4px;}
      .slider{width:100%;}
      .reel{height:104px;font-size:clamp(44px,14vw,72px);}
      .slot-actions{grid-template-columns:1fr;gap:10px;margin-top:10px;}
      .controls{gap:8px;margin-top:12px;}
      .ctrl-fixed{flex:1;min-width:0;}
      .modal{width:min(520px,96vw);}
      .modal .actions{grid-template-columns:1fr;}
      .btn{font-size:15px;padding:15px 18px;min-height:54px;}
      #gameTimer{margin-bottom:8px;}
      .goal-text{margin-bottom:10px;font-size:12px;}
    }

    @media (prefers-reduced-motion:reduce){
      *{animation:none!important;transition:none!important;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div id="gameTimer">20:00</div>
      <div class="goal-text">Goal: Finish the 20:00 timer with as much <strong>Money</strong> as you can. Use the slider to shape your economy, then risk it on the slot.</div>

      <div class="stats-grid">
        <div class="stat money"><div class="label">Money</div><div class="value" id="val1">$0.00</div></div>
        <div class="stat credit"><div class="label">Credit</div><div class="value" id="val2">0.00</div></div>
        <div class="stat rate1"><div class="label">Rate 1</div><div class="value"><span id="rate1">3.00</span></div></div>
        <div class="stat rate2"><div class="label">Rate 2</div><div class="value"><span id="rate2">3.00</span></div></div>
      </div>

      <div class="slider-wrap">
        <div class="slider" id="uniSlider" role="group" aria-label="Growth slider">
          <div class="track"></div>
          <div class="thumb" id="thumb" role="slider" aria-valuemin="2" aria-valuemax="12" aria-valuenow="2" aria-valuetext="2" tabindex="0"></div>
          <div class="ticks ticks-top" id="ticksTop"></div>
          <div class="ticks ticks-bottom" id="ticksBottom"></div>
        </div>
      </div>
      <p class="helper-text" id="growthHelper">Top numbers: <strong>Rate 2</strong> growth ¬∑ Bottom numbers: <strong>Rate 1</strong> growth. Move the slider to favor one rate or the other.</p>

      <div class="controls">
        <button class="ctrl ctrl-fixed" id="swapBtn">Swap</button>
        <button class="ctrl ctrl-fixed" id="pause">Pause</button>
        <button class="ctrl ctrl-fixed" id="upgradeBtn">Upgrade</button>
      </div>

      <section class="slot" aria-label="3-reel slot machine">
        <h2>3‚ÄëReel Slot</h2>
        <p class="helper-text helper-slot">Spins cost <strong>Money</strong> and <strong>Rate 1</strong>. üíé symbols act as wildcards you buy with Credit and Rate 2.</p>
        <div class="reels">
          <div class="reel" id="reel1">üçí</div>
          <div class="reel" id="reel2">üçã</div>
          <div class="reel" id="reel3">üçá</div>
        </div>
        <div class="slot-actions">
          <div class="action">
            <button class="ctrl" id="spin">Spin</button>
            <span class="cost" id="spinCostMsg" aria-live="polite">$50 + 1.0 Rate Point</span>
          </div>
          <div class="action">
            <button class="ctrl ctrl-buy" id="buyBtn">Buy 6x üíé</button>
            <span class="buy-cost-text" id="buyCostMsg" aria-live="polite">500c + 1.0 Rate 2 Point</span>
          </div>
        </div>
      </section>

      <section class="summary" id="runSummary" aria-live="polite" hidden>
        <h2>Run summary</h2>
        <div class="summary-grid">
          <div class="summary-label">Final Money</div><div class="summary-value" id="sumMoney">$0.00</div>
          <div class="summary-label">Final Credit</div><div class="summary-value" id="sumCredit">0.00</div>
          <div class="summary-label">Rate 1</div><div class="summary-value" id="sumRate1">0.00</div>
          <div class="summary-label">Rate 2</div><div class="summary-value" id="sumRate2">0.00</div>
          <div class="summary-label">Total Spins</div><div class="summary-value" id="sumSpins">0</div>
          <div class="summary-label">Wins</div><div class="summary-value" id="sumWins">0</div>
        </div>
      </section>
    </div>
  </div>

  <div class="modal-backdrop" id="winModalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="winTitle" aria-describedby="winDesc">
      <h3 id="winTitle">3‚Äëof‚Äëa‚Äëkind!</h3>
      <p id="winDesc">Choose your reward to continue.</p>
      <div class="actions">
        <button class="btn secondary" id="reduceBtn">Lower spin cost by 0.1 Rate Point</button>
        <button class="btn secondary" id="reduceRate2Btn" style="display: none;">Lower Buy cost by 1.0 Rate 2 Point</button>
        <button class="btn primary" id="takeMoneyBtn">Take $600</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="upgradeModalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="upgradeTitle">
      <h3 id="upgradeTitle">Upgrades</h3>
      <div class="upgrade-option">
        <p>Wins (without üíé) reset Spin cost to $50.<br><small>(One-time purchase)</small></p>
        <button class="btn primary" id="buyResetSpinCost">
          <span class="badge badge-money">$5,000</span> + <span class="badge badge-rate1">10 Rate 1</span>
        </button>
      </div>
      <hr style="border:0; border-top: 1px solid rgba(31,41,55,.9); margin: 20px 0;">
      <div class="upgrade-option">
        <p>Double a specific slider value.<br><small>(4 purchases total, follows a set sequence)</small></p>
        <button class="btn primary" id="buyDoubleSlider">
          <span class="badge badge-credit">15,000 C</span> + <span class="badge badge-rate2">15 Rate 2</span>
        </button>
      </div>
      <div class="actions" style="margin-top: 20px; grid-template-columns: 1fr;">
        <button class="btn secondary" id="closeUpgradeModal">Close</button>
      </div>
    </div>
  </div>

  <canvas id="confettiCanvas"></canvas>

  <script>
  // ===== CONFIG =====
  const MAX_RATE = 199;
  const SPIN_DOLLAR_COST = 50;
  const BUY_DIAMOND_COST = 500;
  const BUY_DIAMOND_RATE_COST = 1.0;
  const GAME_DURATION_SECONDS = 20 * 60; // 20 minutes

  // Slider growth steps (bottom = Rate 1 growth, top = Rate 2 growth)
  let growStepsBottom = [2, 4, 6, 8, 10, 12];
  let growStepsTop = [12, 10, 8, 6, 4, 2];
  const STEP_COUNT = growStepsBottom.length;

  // ===== STATE =====
  let value1 = 0, value2 = 0, rate1 = 3, rate2 = 3, gameTimeSeconds = GAME_DURATION_SECONDS;
  let grow1 = growStepsBottom[0];
  let grow2 = growStepsTop[0];
  let swapUses = 2;

  let spinDollarCost = SPIN_DOLLAR_COST;
  let spinRateCost = 1.0;
  let winMoneyReward = 600;

  let buyDiamondCost = BUY_DIAMOND_COST;
  let buyDiamondRateCost = BUY_DIAMOND_RATE_COST;

  const baseSymbols=['üçí','üçã','üçá','üçâ','üçä'];
  let symbols=[...baseSymbols];
  let diamondCount=0;
  let running=true, modalOpen=false;

  let isSpinCostResetPurchased = false;
  let doubleUpgradeLevel = 0;

  let totalSpins = 0;
  let totalWins = 0;

  // ===== DOM LOOKUPS =====
  const gameTimerEl=document.getElementById('gameTimer');
  const val1El=document.getElementById('val1');
  const val2El=document.getElementById('val2');
  const rate1El=document.getElementById('rate1');
  const rate2El=document.getElementById('rate2');

  const slider=document.getElementById('uniSlider');
  const thumb=document.getElementById('thumb');
  const ticksTopEl = document.getElementById('ticksTop');
  const ticksBottomEl=document.getElementById('ticksBottom');

  const swapBtn = document.getElementById('swapBtn');
  const pauseBtn=document.getElementById('pause');
  const spinBtn=document.getElementById('spin');
  const spinCostMsg=document.getElementById('spinCostMsg');
  const buyBtn=document.getElementById('buyBtn');
  const buyCostMsg=document.getElementById('buyCostMsg');

  const backdrop=document.getElementById('winModalBackdrop');
  const takeMoneyBtn=document.getElementById('takeMoneyBtn');
  const reduceBtn=document.getElementById('reduceBtn');
  const reduceRate2Btn=document.getElementById('reduceRate2Btn');

  const upgradeBtn = document.getElementById('upgradeBtn');
  const upgradeModalBackdrop = document.getElementById('upgradeModalBackdrop');
  const closeUpgradeModalBtn = document.getElementById('closeUpgradeModal');
  const buyResetSpinCostBtn = document.getElementById('buyResetSpinCost');
  const buyDoubleSliderBtn = document.getElementById('buyDoubleSlider');

  const confettiCanvas = document.getElementById('confettiCanvas');
  const confettiCtx = confettiCanvas.getContext('2d');
  let confettiParticles = [];
  let confettiAnimationId;

  const summaryEl = document.getElementById('runSummary');
  const sumMoneyEl = document.getElementById('sumMoney');
  const sumCreditEl = document.getElementById('sumCredit');
  const sumRate1El = document.getElementById('sumRate1');
  const sumRate2El = document.getElementById('sumRate2');
  const sumSpinsEl = document.getElementById('sumSpins');
  const sumWinsEl = document.getElementById('sumWins');

  const reelEls=[document.getElementById('reel1'),document.getElementById('reel2'),document.getElementById('reel3')];

  // ===== UTILS =====
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const fmt=(n)=>n.toFixed(2);
  const fmtRatePts=(x)=>x.toFixed(1);
  const fmtTime=(t)=>{const s=Math.floor(t),m=Math.floor(s/60),sec=s%60;return [m,sec].map(v=>String(v).padStart(2,'0')).join(':')};

  // ===== CONFETTI =====
  function startConfetti() {
    confettiCanvas.style.display = 'block';
    confettiParticles = [];
    const particleCount = 200;
    const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];

    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;

    for (let i = 0; i < particleCount; i++) {
      confettiParticles.push({
        x: Math.random() * confettiCanvas.width,
        y: Math.random() * confettiCanvas.height - confettiCanvas.height,
        size: Math.random() * 5 + 2,
        color: colors[Math.floor(Math.random() * colors.length)],
        vx: Math.random() * 6 - 3,
        vy: Math.random() * 5 + 3,
        opacity: 1,
      });
    }
    animateConfetti();
  }

  function animateConfetti() {
    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

    confettiParticles.forEach((p, index) => {
      p.x += p.vx;
      p.y += p.vy;
      p.opacity -= 0.005;

      if (p.y > confettiCanvas.height || p.opacity <= 0) {
        confettiParticles.splice(index, 1);
      } else {
        confettiCtx.globalAlpha = p.opacity;
        confettiCtx.fillStyle = p.color;
        confettiCtx.fillRect(p.x, p.y, p.size, p.size * 2);
        confettiCtx.globalAlpha = 1;
      }
    });

    if (confettiParticles.length > 0) {
      confettiAnimationId = requestAnimationFrame(animateConfetti);
    } else {
      stopConfetti();
    }
  }

  function stopConfetti() {
    if (confettiAnimationId) {
      cancelAnimationFrame(confettiAnimationId);
    }
    confettiCanvas.style.display = 'none';
    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    confettiParticles = [];
  }

  window.addEventListener('resize', () => {
    if (confettiCanvas.style.display === 'block') {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
  });

  // ===== UI UPDATE HELPERS =====
  function updateCostMsg(){
    spinCostMsg.innerHTML = `<span class="badge badge-money">$${spinDollarCost}</span> + <span class="badge badge-rate1">${fmtRatePts(spinRateCost)} Rate 1</span>`;
  }

  function updateBuyBtnUI(){
    if(diamondCount>0){
      buyCostMsg.textContent=`üíé Active (${diamondCount} left)`;
      buyBtn.disabled=true;
    } else {
      buyCostMsg.innerHTML=`<span class="badge badge-credit">${buyDiamondCost}c</span> + <span class="badge badge-rate2">${buyDiamondRateCost.toFixed(1)} Rate 2</span>`;
      buyBtn.disabled=false;
    }
  }

  function updateReadout(){
    if (gameTimeSeconds > 0 || running) {
      gameTimerEl.textContent = fmtTime(gameTimeSeconds);
    }
    val1El.textContent=`$${fmt(value1)}`;
    val2El.textContent=fmt(value2);
    rate1El.textContent=fmt(rate1);
    rate2El.textContent=fmt(rate2);
  }

  function showSummary(){
    if(!summaryEl) return;
    sumMoneyEl.textContent = `$${fmt(value1)}`;
    sumCreditEl.textContent = fmt(value2);
    sumRate1El.textContent = fmt(rate1);
    sumRate2El.textContent = fmt(rate2);
    sumSpinsEl.textContent = String(totalSpins);
    sumWinsEl.textContent = String(totalWins);
    summaryEl.hidden = false;
  }

  // ===== SLIDER =====
  function buildTicks(){
    ticksBottomEl.innerHTML='';
    ticksTopEl.innerHTML = '';

    const growStepsDesc = [...growStepsTop];

    const createTicks = (parentElement, steps) => {
      steps.forEach((value, idx) => {
        const s = document.createElement('span');
        s.textContent = value;
        s.style.position = 'absolute';

        const pct = (STEP_COUNT <= 1) ? 0 : (idx / (STEP_COUNT - 1));
        s.style.left = `${pct * 100}%`;

        if (idx === 0) {
          s.style.transform = 'translateX(0)';
        } else if (idx === STEP_COUNT - 1) {
          s.style.transform = 'translateX(-100%)';
        } else {
          s.style.transform = 'translateX(-50%)';
        }
        parentElement.appendChild(s);
      });
    };

    createTicks(ticksBottomEl, growStepsBottom);
    createTicks(ticksTopEl, growStepsDesc);
  }

  function sliderInnerRect(){
    const r=slider.getBoundingClientRect();
    const left=r.left+24, right=r.right-24, width=Math.max(0,right-left);
    return {left,right,width};
  }

  function positionHandleByIndex(idx){
    const {left,width}=sliderInnerRect();
    const pct = (STEP_COUNT<=1)?0: idx/(STEP_COUNT-1);
    const x = left + pct*width;
    thumb.style.left = `${x - slider.getBoundingClientRect().left}px`;
    const val = growStepsBottom[idx];
    thumb.setAttribute('aria-valuenow', String(val));
    thumb.setAttribute('aria-valuetext', String(val));
  }

  function nearestIndexFromClientX(xc){
    const {left,width}=sliderInnerRect();
    const x = clamp(xc-left,0,width);
    const pct = width===0?0:x/width;
    return clamp(Math.round(pct*(STEP_COUNT-1)),0,STEP_COUNT-1);
  }

  function setGrowthByIndex(idx){
    const v1 = growStepsBottom[idx];
    const v2 = growStepsTop[idx];
    grow1=v1; grow2=v2;
    positionHandleByIndex(idx);
  }

  function currentIndex(){ return Math.max(0, growStepsBottom.indexOf(grow1)); }

  function makeSliderInteractive(){
    buildTicks();
    setGrowthByIndex(0);
    let dragging=false;
    const onDown=(ev)=>{ if(modalOpen) return; dragging=true; thumb.focus(); const c=('touches'in ev)?ev.touches[0].clientX:ev.clientX; setGrowthByIndex(nearestIndexFromClientX(c)); ev.preventDefault(); };
    const onMove=(ev)=>{ if(!dragging || modalOpen) return; const c=('touches'in ev)?ev.touches[0].clientX:ev.clientX; setGrowthByIndex(nearestIndexFromClientX(c)); };
    const onUp=()=>{ dragging=false; };
    thumb.addEventListener('mousedown', onDown);
    thumb.addEventListener('touchstart', onDown, {passive:false});
    window.addEventListener('mousemove', onMove);
    window.addEventListener('touchmove', onMove, {passive:false});
    window.addEventListener('mouseup', onUp);
    window.addEventListener('touchend', onUp);
    slider.addEventListener('mousedown', (ev)=>{ if(ev.target===thumb || modalOpen) return; const c=ev.clientX; setGrowthByIndex(nearestIndexFromClientX(c)); });
    slider.addEventListener('touchstart', (ev)=>{ if(ev.target===thumb || modalOpen) return; const c=ev.touches[0].clientX; setGrowthByIndex(nearestIndexFromClientX(c)); }, {passive:false});
    thumb.addEventListener('keydown',(e)=>{
      if(modalOpen) return;
      let idx=currentIndex();
      if(e.key==='ArrowLeft'){ idx=clamp(idx-1,0,STEP_COUNT-1); setGrowthByIndex(idx); e.preventDefault(); }
      if(e.key==='ArrowRight'){ idx=clamp(idx+1,0,STEP_COUNT-1); setGrowthByIndex(idx); e.preventDefault(); }
      if(e.key==='Home'){ setGrowthByIndex(0); e.preventDefault(); }
      if(e.key==='End'){ setGrowthByIndex(STEP_COUNT-1); e.preventDefault(); }
    });
    const ro=new ResizeObserver(()=> positionHandleByIndex(currentIndex()));
    ro.observe(slider);
  }

  // ===== MODALS =====
  function openWinChoice(){
    return new Promise((resolve)=>{
      modalOpen=true;
      takeMoneyBtn.textContent=`Take $${winMoneyReward}`;

      let focusables;
      if (spinRateCost <= 0) {
        reduceBtn.style.display = 'none';
        reduceRate2Btn.style.display = 'block';
        focusables = [reduceRate2Btn, takeMoneyBtn];
      } else {
        reduceBtn.style.display = 'block';
        reduceRate2Btn.style.display = 'none';
        focusables = [reduceBtn, takeMoneyBtn];
      }

      backdrop.style.display='flex';
      backdrop.setAttribute('aria-hidden','false');

      let idx=0; focusables[idx].focus();
      function onKey(e){ if(e.key==='Tab'){ e.preventDefault(); idx=(idx+(e.shiftKey?-1:1)+focusables.length)%focusables.length; focusables[idx].focus(); } if(e.key==='Escape'){ e.preventDefault(); } }
      document.addEventListener('keydown', onKey);

      function cleanup(){
        document.removeEventListener('keydown', onKey);
        backdrop.style.display='none';
        backdrop.setAttribute('aria-hidden','true');
        modalOpen=false;
        reduceBtn.style.display = 'block';
        reduceRate2Btn.style.display = 'none';
      }

      reduceBtn.onclick=()=>{ cleanup(); resolve('reduce'); };
      reduceRate2Btn.onclick=()=>{ cleanup(); resolve('reduceRate2'); };
      takeMoneyBtn.onclick=()=>{ cleanup(); resolve('money'); };
    });
  }

  function openUpgradeModal() {
    modalOpen = true;
    upgradeModalBackdrop.style.display = 'flex';
    upgradeModalBackdrop.setAttribute('aria-hidden', 'false');

    buyResetSpinCostBtn.disabled = isSpinCostResetPurchased;
    if (isSpinCostResetPurchased) {
      buyResetSpinCostBtn.textContent = "Purchased";
    } else {
      buyResetSpinCostBtn.innerHTML = `<span class="badge badge-money">$5,000</span> + <span class="badge badge-rate1">10 Rate 1</span>`;
    }

    let remaining = doubleUpgradeLevel < 4;
    buyDoubleSliderBtn.disabled = !remaining;
    if (!remaining) {
      buyDoubleSliderBtn.textContent = "Maxed Out";
    } else {
      buyDoubleSliderBtn.innerHTML = `<span class="badge badge-credit">15,000 C</span> + <span class="badge badge-rate2">15 Rate 2</span>`;
    }

    closeUpgradeModalBtn.focus();
  }

  function closeUpgradeModal() {
    modalOpen = false;
    upgradeModalBackdrop.style.display = 'none';
    upgradeModalBackdrop.setAttribute('aria-hidden', 'true');
  }

  // ===== SLOT / SPIN =====
  const visualSymbol=()=>symbols[Math.floor(Math.random()*symbols.length)];

  function animateReel(reelEl, finalSymbol, duration) {
    return new Promise(resolve => {
      const startTime = performance.now();
      let lastUpdate = startTime;
      const minInterval = 50;
      const maxInterval = 200;

      reelEl.style.transition = 'filter 0.1s, opacity 0.1s';
      reelEl.style.filter = 'blur(3px)';
      reelEl.style.opacity = '0.8';

      function spin(currentTime) {
        const elapsedTime = currentTime - startTime;
        let progress = elapsedTime / duration;
        if (progress > 1) progress = 1;
        const progress_easeout = 1 - Math.pow(1 - progress, 3);
        const currentInterval = minInterval + (maxInterval - minInterval) * progress_easeout;

        if (currentTime - lastUpdate > currentInterval) {
          reelEl.textContent = visualSymbol();
          lastUpdate = currentTime;
        }

        if (progress < 1) {
          requestAnimationFrame(spin);
        } else {
          reelEl.style.transition = 'filter 0.3s, opacity 0.3s';
          reelEl.style.filter = 'blur(0px)';
          reelEl.style.opacity = '1';
          reelEl.textContent = finalSymbol;
          resolve();
        }
      }
      requestAnimationFrame(spin);
    });
  }

  function randomSymbol(){
    let s=symbols[Math.floor(Math.random()*symbols.length)];
    if(s==='üíé'){
      if(diamondCount>0){
        diamondCount--;
        updateBuyBtnUI();
        if(diamondCount===0) symbols=symbols.filter(x=>x!=='üíé');
        return 'üíé';
      } else {
        return baseSymbols[Math.floor(Math.random()*baseSymbols.length)];
      }
    }
    return s;
  }

  async function spinOnce(){
    if(!spinBtn || spinBtn.disabled || modalOpen) return;
    if(value1 < spinDollarCost || rate1 < spinRateCost){
      spinBtn.animate([{transform:'translateX(0)'},{transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}],{duration:180});
      return;
    }

    totalSpins++;

    value1 -= spinDollarCost;
    rate1 = Math.max(0, rate1 - spinRateCost);
    spinDollarCost += 1;
    updateCostMsg();
    updateReadout();
    spinBtn.disabled=true;
    pauseBtn.disabled=true;
    swapBtn.disabled=true;
    buyBtn.disabled=true;
    upgradeBtn.disabled=true;

    const durations = [600, 800, 1000];
    const finalSyms = [randomSymbol(), randomSymbol(), randomSymbol()];

    await Promise.all(reelEls.map((el, i) =>
      animateReel(el, finalSyms[i], durations[i])
    ));

    const nonWild=finalSyms.filter(s=>s!=='üíé');
    let win=false;
    if(nonWild.length<=1) win=true;
    else if(nonWild.length===2) win=(nonWild[0]===nonWild[1]);
    else win=(finalSyms[0]===finalSyms[1] && finalSyms[1]===finalSyms[2]);

    if(win){
      totalWins++;

      if (isSpinCostResetPurchased && !finalSyms.includes('üíé')) {
        spinDollarCost = SPIN_DOLLAR_COST;
        updateCostMsg();
      }

      reelEls.forEach(el => el.classList.add('reel-win'));
      await new Promise(resolve => setTimeout(resolve, 1000));
      reelEls.forEach(el => el.classList.remove('reel-win'));

      startConfetti();
      const choice=await openWinChoice();
      stopConfetti();

      const rewardThisWin=winMoneyReward;

      if(choice==='money'){
        value1 += rewardThisWin;
      } else if (choice === 'reduce') {
        spinRateCost = Math.max(0, +(spinRateCost - 0.1).toFixed(1));
        updateCostMsg();
      } else if (choice === 'reduceRate2') {
        buyDiamondRateCost = Math.max(0, buyDiamondRateCost - 1.0);
        updateBuyBtnUI();
      }

      winMoneyReward = rewardThisWin + 600;
    }

    if (running) {
      pauseBtn.disabled=false;
      swapBtn.disabled = (swapUses <= 0);
      buyBtn.disabled=false;
      upgradeBtn.disabled=false;
    }
    spinBtn.disabled=false;
    updateReadout();
  }

  // ===== CONTROLS =====
  function attachControls(){
    swapBtn.textContent = `Swap (${swapUses})`;
    swapBtn.addEventListener('click', ()=>{
      if (modalOpen || swapUses <= 0) return;
      [value1, value2] = [value2, value1];
      swapUses--;
      swapBtn.textContent = `Swap (${swapUses})`;
      if (swapUses <= 0) {
        swapBtn.disabled = true;
      }
      updateReadout();
    });

    pauseBtn.addEventListener('click', ()=>{
      if (modalOpen) return;
      running=!running; pauseBtn.textContent= running? 'Pause':'Resume';
    });

    buyBtn.addEventListener('click', ()=>{
      if (modalOpen) return;
      if(value2>=buyDiamondCost && rate2>=buyDiamondRateCost && diamondCount===0){
        value2-=buyDiamondCost;
        rate2=Math.max(0, rate2-buyDiamondRateCost);
        diamondCount=6;
        if(!symbols.includes('üíé')) symbols.push('üíé');
        buyDiamondCost+=500;
        buyDiamondRateCost+=1;
        updateBuyBtnUI();
        updateReadout();
      } else {
        if(value2<buyDiamondCost || rate2<buyDiamondRateCost){
          buyBtn.animate([{transform:'translateX(0)'},{transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}],{duration:180});
        }
      }
    });

    spinBtn.addEventListener('click', spinOnce);
    spinBtn.addEventListener('keydown',(e)=>{
      if(modalOpen){ e.preventDefault(); return; }
      if(e.key===' '||e.key==='Enter'){ e.preventDefault(); spinOnce(); }
    });

    upgradeBtn.addEventListener('click', openUpgradeModal);
    closeUpgradeModalBtn.addEventListener('click', closeUpgradeModal);

    buyResetSpinCostBtn.addEventListener('click', () => {
      if (isSpinCostResetPurchased) return;
      if (value1 < 5000 || rate1 < 10) {
        buyResetSpinCostBtn.animate([{transform:'translateX(0)'},{transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}],{duration:180});
        return;
      }
      value1 -= 5000;
      rate1 -= 10;
      isSpinCostResetPurchased = true;
      buyResetSpinCostBtn.disabled = true;
      buyResetSpinCostBtn.textContent = "Purchased";
      updateReadout();
    });

    buyDoubleSliderBtn.addEventListener('click', () => {
      if (doubleUpgradeLevel >= 4) return;

      if (value2 < 15000 || rate2 < 15) {
        buyDoubleSliderBtn.animate([{transform:'translateX(0)'},{transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}],{duration:180});
        return;
      }

      value2 -= 15000;
      rate2 -= 15;

      switch (doubleUpgradeLevel) {
        case 0:
          growStepsTop[1] *= 2;
          break;
        case 1:
          growStepsBottom[4] *= 2;
          break;
        case 2:
          growStepsTop[0] *= 2;
          break;
        case 3:
          growStepsBottom[5] *= 2;
          break;
      }

      doubleUpgradeLevel++;

      buildTicks();
      setGrowthByIndex(currentIndex());
      updateReadout();

      if (doubleUpgradeLevel >= 4) {
        buyDoubleSliderBtn.disabled = true;
        buyDoubleSliderBtn.textContent = "Maxed Out";
      }
    });
  }

  // ===== GAME LOOP =====
  let lastTs;
  function tick(ts){
    if(lastTs===undefined) lastTs=ts;
    const dt=(ts-lastTs)/1000;
    lastTs=ts;

    if(running && dt>0){
      gameTimeSeconds -= dt;

      value1 += rate1 * dt;
      value2 += rate2 * dt;
      const gps1=(grow1/60), gps2=(grow2/60);
      rate1=Math.min(MAX_RATE, rate1 + gps1*dt);
      rate2=Math.min(MAX_RATE, rate2 + gps2*dt);

      if (gameTimeSeconds <= 0) {
        gameTimeSeconds = 0;
        running = false;
        pauseBtn.disabled = true;
        spinBtn.disabled = true;
        buyBtn.disabled = true;
        if (swapBtn) swapBtn.disabled = true;
        if (upgradeBtn) upgradeBtn.disabled = true;
        pauseBtn.textContent = "Over";
        showSummary();
      }
    }

    updateReadout();

    if (gameTimeSeconds > 0 || (gameTimeSeconds <= 0 && running)) {
      requestAnimationFrame(tick);
    } else if (gameTimeSeconds <= 0 && !running) {
      gameTimerEl.textContent = "GAME OVER";
    }
  }

  // ===== INIT =====
  function init(){
    makeSliderInteractive();
    updateCostMsg();
    updateBuyBtnUI();
    attachControls();
    requestAnimationFrame(tick);
  }

  init();
  </script>
</body>
</html>
