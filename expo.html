<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mobile Emoji RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the mobile-first game */
        :root {
            --bg-color: #1a202c;
            --container-bg: #2d3748;
            --ui-bg: #4a5568;
            --ui-border: #718096;
            --text-light: #e2e8f0;
            --text-medium: #a0aec0;
            --accent-green: #48bb78;
            --accent-red: #f56565;
            --accent-blue: #63b3ed;
            --accent-purple: #d53f8c;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background-color: var(--bg-color);
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-container {
            width: 100%;
            height: 100%;
            background-color: var(--container-bg);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Central game area */
        .battle-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            padding: 1rem;
        }

        .enemy {
            transition: all 0.3s ease;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
        }

        .enemy.attacked {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-8px, 8px); }
            50% { transform: translate(8px, -8px); }
            75% { transform: translate(-8px, -8px); }
        }
        
        .health-bar-container {
            width: 80px;
            height: 8px;
            background-color: var(--ui-border);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }
        .health-bar {
            height: 100%;
            background-color: var(--accent-green);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Player UI */
        #player-area {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 220px; /* Space for the action bar */
        }
         #player-status {
            width: 120px;
         }
         #player-health-bar {
             background-color: var(--accent-blue);
         }


        /* Action Bar */
        #action-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 250px;
            background-color: var(--ui-bg);
            border-top: 4px solid var(--ui-border);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Carousel */
        .carousel-container {
            height: 80px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        .carousel-category-title {
            position: absolute;
            top: 5px;
            left: 10px;
            font-size: 0.6rem;
            color: var(--text-medium);
            z-index: 2;
        }
        .carousel-track {
            display: flex;
            height: 100%;
            position: absolute;
            left: 0;
            transition: transform 0.3s ease-out;
            touch-action: pan-y; /* Allow vertical scroll on page */
        }
        .carousel-item {
            width: 80px;
            height: 100%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            opacity: 0.5;
            transform: scale(0.8);
            transition: all 0.3s ease-out;
        }
        .carousel-item.active {
            opacity: 1;
            transform: scale(1.1);
            text-shadow: 0 0 15px white;
        }
        .carousel-center-marker {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border-radius: 10px;
            border: 2px solid var(--text-light);
            pointer-events: none;
            z-index: 1;
        }

        /* Stats Display Area */
        #stats-display {
            display: flex;
            justify-content: space-around;
            text-align: center;
            font-size: 0.6rem;
            color: var(--text-medium);
            padding: 0.5rem 0;
        }

        #start-round-btn {
            transition: all 0.3s ease;
            width: 100%;
            height: 50px;
            font-size: 1rem;
        }
         #start-round-btn:disabled {
            background-color: #718096;
            cursor: not-allowed;
            opacity: 0.6;
        }

    </style>
</head>
<body>

    <div class="game-container">

        <div class="battle-area">
            <!-- Enemies -->
            <div id="enemy-container" class="flex items-end space-x-6">
                <!-- JS Generated -->
            </div>
        </div>

        <div id="player-area">
            <!-- Player Status -->
            <div id="player-status" class="text-center">
                 <div class="text-5xl mb-2">üßë‚ÄçüöÄ</div>
                 <div class="w-full bg-gray-600 rounded-full h-3 border-2 border-gray-500">
                     <div id="player-health-bar" class="h-full rounded-full" style="width: 100%"></div>
                 </div>
                 <div id="player-health-text" class="text-xs mt-1">100 / 100</div>
             </div>
        </div>


        <div id="action-bar">
            <!-- Stats Display -->
            <div id="stats-display">
                <div id="attack-stat">‚öîÔ∏è 15</div>
                <div id="heal-stat">‚ù§Ô∏è 20</div>
                <div id="defense-stat">üõ°Ô∏è 50%</div>
                <div id="magic-stat">‚ú® 18</div>
            </div>

             <!-- Carousels -->
            <div class="carousel-container" id="attack-carousel-container">
                 <div class="carousel-category-title">Attack</div>
                 <div class="carousel-track" id="attack-track"></div>
                 <div class="carousel-center-marker"></div>
            </div>

            <!-- Start Button -->
            <button id="start-round-btn" class="mt-4 px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg text-lg shadow-lg" onclick="startRound()">
                Start Round
            </button>
        </div>
        
        <!-- Game Over Modal -->
        <div id="game-over-modal" class="hidden absolute inset-0 bg-black bg-opacity-75 flex-col items-center justify-center text-center z-50">
            <h2 id="game-over-text" class="text-4xl mb-4"></h2>
            <button onclick="location.reload()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg text-lg">Play Again</button>
        </div>

    </div>

    <script>
        // --- DATA ---
        const items = {
            attack: [
                { emoji: '‚öîÔ∏è', name: 'Sword', power: 15 },
                { emoji: 'ÔøΩ', name: 'Bow', power: 12 },
                { emoji: 'üí£', name: 'Bomb', power: 25 },
                { emoji: 'Âåï', name: 'Dagger', power: 10 },
            ],
            heal: [
                { emoji: '‚ù§Ô∏è', name: 'Small Potion', power: 20 },
                { emoji: 'üíñ', name: 'Large Potion', power: 40 },
                { emoji: 'ü•ó', name: 'Salad', power: 15 },
                { emoji: 'üçñ', name: 'Meat', power: 30 },
            ],
            defense: [
                { emoji: 'üõ°Ô∏è', name: 'Shield', power: 0.5, display: "50%" }, // display text
                { emoji: 'üß±', name: 'Wall', power: 0.2, display: "80%" },
                { emoji: 'üí®', name: 'Dodge', power: 0.0, display: "100%" },
            ],
            magic: [
                { emoji: '‚ú®', name: 'Sparkle', power: 18 },
                { emoji: 'üî•', name: 'Fireball', power: 30 },
                { emoji: '‚ùÑÔ∏è', name: 'Freeze', power: 10 },
                { emoji: '‚ö°', name: 'Lightning', power: 22 },
            ],
        };

        let enemies = [
            { id: 'enemy-1', emoji: 'üëπ', name: 'Ogre', hp: 80, maxHp: 80, attack: 10 },
            { id: 'enemy-2', emoji: 'üëª', name: 'Ghost', hp: 60, maxHp: 60, attack: 15 },
            { emoji: 'üê≤', name: 'Dragon', hp: 120, maxHp: 120, attack: 20, id: 'enemy-3' },
        ];
        
        let player = { hp: 100, maxHp: 100, defenseModifier: 1.0 };
        const currentSelections = { attack: 0, heal: 0, defense: 0, magic: 0 };
        let isRoundInProgress = false;

        // --- DOM ELEMENTS ---
        const enemyContainer = document.getElementById('enemy-container');
        const startRoundBtn = document.getElementById('start-round-btn');
        const playerHealthBar = document.getElementById('player-health-bar');
        const playerHealthText = document.getElementById('player-health-text');
        const statsDisplay = {
            attack: document.getElementById('attack-stat'),
            heal: document.getElementById('heal-stat'),
            defense: document.getElementById('defense-stat'),
            magic: document.getElementById('magic-stat'),
        };

        // --- CAROUSEL LOGIC ---
        function setupCarousels() {
            // Replaced old corner selectors with a single dynamic one.
            const actionBar = document.getElementById('action-bar');
            const button = actionBar.querySelector('button');
            actionBar.innerHTML = ''; // Clear old content
             actionBar.appendChild(statsDisplay.attack.parentElement);
            
            Object.keys(items).forEach(category => {
                const container = document.createElement('div');
                container.className = 'carousel-container';
                container.innerHTML = `
                    <div class="carousel-category-title">${category}</div>
                    <div class="carousel-track" id="${category}-track"></div>
                    <div class="carousel-center-marker"></div>
                `;
                actionBar.appendChild(container);

                const track = container.querySelector('.carousel-track');
                items[category].forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'carousel-item';
                    div.textContent = item.emoji;
                    track.appendChild(div);
                });

                setupCarouselEvents(container, track, category);
                updateCarousel(track, category, 0);
            });
            actionBar.appendChild(button);
        }

        function setupCarouselEvents(container, track, category) {
            let isDragging = false;
            let startX, scrollLeft, velocity, startT;

            const itemWidth = 80;
            const centerOffset = (container.clientWidth / 2) - (itemWidth / 2);

            function updatePosition(x) {
                const dx = x - startX;
                track.style.transition = 'none';
                track.style.transform = `translateX(${scrollLeft + dx}px)`;
            }
            
            function snapToItem() {
                const currentTransform = new DOMMatrix(getComputedStyle(track).transform).e;
                const closestIndex = Math.round((centerOffset - currentTransform) / itemWidth);
                const finalIndex = Math.max(0, Math.min(items[category].length - 1, closestIndex));
                
                currentSelections[category] = finalIndex;
                updateCarousel(track, category, finalIndex);
            }
            
            track.addEventListener('touchstart', (e) => {
                if (isRoundInProgress) return;
                isDragging = true;
                startX = e.touches[0].pageX;
                const currentTransform = new DOMMatrix(getComputedStyle(track).transform).e;
                scrollLeft = currentTransform;
                track.style.transition = 'none';
            });

            track.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                updatePosition(e.touches[0].pageX);
            });

            const endDrag = (e) => {
                 if (!isDragging) return;
                isDragging = false;
                snapToItem();
            };

            track.addEventListener('touchend', endDrag);
            track.addEventListener('touchcancel', endDrag);
        }
        
        function updateCarousel(track, category, newIndex) {
            const itemWidth = 80;
            const containerWidth = track.parentElement.clientWidth;
            const centerOffset = (containerWidth / 2) - (itemWidth / 2);
            const newTransform = centerOffset - (newIndex * itemWidth);
            
            track.style.transition = 'transform 0.3s ease-out';
            track.style.transform = `translateX(${newTransform}px)`;

            Array.from(track.children).forEach((item, index) => {
                item.classList.toggle('active', index === newIndex);
            });

            updateStatsDisplay(category, newIndex);
        }

        function updateStatsDisplay(category, index) {
            const item = items[category][index];
            const statEl = statsDisplay[category];
            if (!statEl) return;
            const displayValue = item.display || item.power;
            statEl.innerHTML = `${item.emoji} ${displayValue}`;
        }


        // --- GAME LOGIC ---

        function updateEnemyDisplay() {
            enemyContainer.innerHTML = '';
            enemies.forEach(enemy => {
                 if (enemy.hp <= 0) return;
                 const enemyDiv = document.createElement('div');
                 enemyDiv.id = enemy.id;
                 enemyDiv.className = 'enemy text-center';
                 enemyDiv.innerHTML = `
                    <div class="text-6xl">${enemy.emoji}</div>
                    <div class="health-bar-container">
                        <div id="${enemy.id}-health" class="health-bar" style="width: ${(enemy.hp / enemy.maxHp) * 100}%"></div>
                    </div>
                    <div class="text-xs mt-1">${enemy.hp} / ${enemy.maxHp}</div>
                `;
                 enemyContainer.appendChild(enemyDiv);
            });
        }
        
        function updatePlayerDisplay() {
            const healthPercentage = Math.max(0, (player.hp / player.maxHp) * 100);
            playerHealthBar.style.width = `${healthPercentage}%`;
            playerHealthText.textContent = `${Math.max(0, player.hp)} / ${player.maxHp}`;
        }

        async function startRound() {
            if (isRoundInProgress || player.hp <= 0) return;
            isRoundInProgress = true;
            startRoundBtn.disabled = true;

            // --- Player's Turn ---
            const defenseItem = items.defense[currentSelections.defense];
            player.defenseModifier = defenseItem.power;
            
            const healItem = items.heal[currentSelections.heal];
            player.hp = Math.min(player.maxHp, player.hp + healItem.power);
            updatePlayerDisplay();
            await sleep(500);

            const attackItem = items.attack[currentSelections.attack];
            const magicItem = items.magic[currentSelections.magic];
            
            let targetEnemy = enemies.find(e => e.hp > 0);
            if (targetEnemy) {
                targetEnemy.hp -= attackItem.power;
                targetEnemy.hp -= magicItem.power;
                
                document.getElementById(targetEnemy.id)?.classList.add('attacked');
                updateEnemyDisplay();
                await sleep(500);
                document.getElementById(targetEnemy.id)?.classList.remove('attacked');
            } else {
                 showGameOver(true);
                 return;
            }
            updateEnemyDisplay();
            await sleep(500);
            
            const livingEnemies = enemies.filter(e => e.hp > 0);
            if(livingEnemies.length === 0){
                showGameOver(true);
                return;
            }

            // --- Enemies' Turn ---
            for (const enemy of livingEnemies) {
                const damage = Math.round(enemy.attack * player.defenseModifier);
                player.hp -= damage;
                updatePlayerDisplay();
                if(player.hp <= 0) {
                    showGameOver(false);
                    return;
                }
                await sleep(500);
            }
            
            player.defenseModifier = 1.0;
            isRoundInProgress = false;
            startRoundBtn.disabled = false;
        }

        function showGameOver(isVictory) {
            const modal = document.getElementById('game-over-modal');
            const text = document.getElementById('game-over-text');
            modal.style.display = 'flex';
            text.textContent = isVictory ? "You Win!" : "Game Over";
            text.style.color = isVictory ? 'gold' : 'red';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function init() {
            setupCarousels();
            updateEnemyDisplay();
            updatePlayerDisplay();
             Object.keys(items).forEach(category => {
                updateStatsDisplay(category, 0);
            });
        }

        window.onload = init;

    </script>
</body>
</html>
